KISSY.add(function(c,f,a,d,g,b){var j=c.DOM,e=c.all,i=c.Event;function h(P){var w=this;var V=V||P.skuList,m=P.skuId||"skus",W=P.id||"skuId",r=P.delId||"g",Z=P.loadUrl||"",B=P.searchUrl,S=P.autoSearch===false?false:true,ac=P.gridError||"gridError",T=c.one("#"+ac),aa=P.errorMsg||"\u8ba1\u5212\u5165\u5e93\u91cf\u4e0d\u80fd\u4e3a\u7a7a\uff01",ab=P.validator||function(ae){return true},o=P.dialogTitle||"\u6dfb\u52a0\u5546\u54c1",y=P.matchFunc||function(af,ae){if(!af||!ae){return false}return af[W]==ae[W]},q=[],X=P.pColumns,Y=new c.LP.Store({url:Z,autoLoad:!!Z,remoteSort:false}),F=F(X);var ad={renderTo:"pgrid",checkable:false,columns:X,store:Y,loadMask:true};if(F){ad.listeners={aftershow:function(){var af={},ae=Y.getResult();if(ae.length==0){return}c.each(X,function(ag){if(ag.summary){af[ag.dataIndex]=0}});c.each(ae,function(ag){for(var ah in af){if(af.hasOwnProperty(ah)){af[ah]+=(ag[ah]||0)}}});s.addSummary(af)}}}if(!T){T=new c.Node('<div class="form-line ks-clear"><span id="'+ac+'" class="form-field-container"></span></div>').appendTo(c.one("#pgrid").parent())}var s=new c.LP.EditGrid(ad);var n=new c.LP.Store({url:B,autoLoad:S});var J=P.searchColumns||[{title:"\u8d27\u54c1\u540d\u79f0",width:100,sortable:true,dataIndex:"productName"},{title:"SKU-ID",width:100,sortable:true,dataIndex:"skuId"},{title:"SKU\u5c5e\u6027",width:100,sortable:true,dataIndex:"skuProperties"},{title:"\u91cd\u91cf",width:80,sortable:true,dataIndex:"weight"},{title:"\u4f53\u79ef",width:120,sortable:true,dataIndex:"length",renderer:function(af,ae){if(ae.length&&ae.width&&ae.height){return ae.length+"*"+ae.width+"*"+ae.height}else{return""}}}];var E={renderTo:"popgrid",width:588,checkable:true,forceFit:true,height:325,columns:J,store:n,bbar:{pageSize:10},loadMask:true};var U=new c.LP.Grid(E);var k={width:600,height:400,title:"\u6dfb\u52a0\u5546\u54c1",contentID:"ks-userTemplate",buttons:[{text:"\u786e\u8ba4",eventType:"click",handler:function(){var ae=Y.getResult();delRow=[];c.each(ae,function(af){if(A(af,q)==-1){delRow.push(af)}});Y.add(q,true,y);Y.remove(delRow,y);this.close()}},{text:"\u5173\u95ed",eventType:"click",handler:function(){this.close()}}]};x();if(!Z&&V){Y.setResult(V)}function F(af){var ae=false;c.each(af,function(ag){if(ag.summary){ae=true;return false}});return ae}function x(){var ae=c.one("#btn");if(ae){var af=null;ae.on("click",function(){var ai=c.one("#sellerCode");if(ai){var ah=ai.val();if(af!==ah){af=ah;n.load({sellerCode:ah,start:0,pageIndex:0})}}q=c.clone(Y.getResult())||[];z();var ag=new c.LP.Dialog(k);ag.show()})}i.on("#form","submit",function(ah){var ag=Y.getResult();if(ag.length==0||ag.length>50){ah.preventDefault();u("\u9009\u62e9SKU\u6570\u91cf\u4e0d\u5728\u8303\u56f4\u4e4b\u5185 0 - 50 \u5185");return}if(p(ag)){O();var ai=c.JSON.stringify(ag);j.val("#"+m,ai)}else{ah.preventDefault();u(aa)}});K()}function Q(){var ae=Y.getResult();if(ae.length==0||ae.length>50){return false}return p(ae)}function K(){s.on("cellclick",function(ae){var af=ae.domTarget;if(ae.field==r&&j.hasClass(af,"grid-command")){ae.preventDefault();Y.remove(ae.data)}});U.on("aftershow",function(){z();D()})}function H(af){var ae=af.data;if(A(ae,q)==-1){q.push(ae)}}function l(ag){var ae=ag.data,af=A(ae,q);if(af!==-1){q.splice(af,1)}}function D(){U.on("rowselected",H);U.on("rowunselected",l)}function C(){U.detach("rowselected",H);U.detach("rowunselected",l)}function u(af){if(T){var ae='<label class="valid-text" style=""><span class="estate error"><em class="label">'+af+"</em></span></label>";T.html(ae)}}function O(){if(T){T.text("")}}function p(ae){var af=true;c.each(ae,function(ag){if(!ab(ag)){af=false;return false}});return af}function z(){C();var ae=L(W,q);U.clearSelection();U.setSelection(W,ae);D()}function A(ah,ag){var ae=-1,af=ag;c.each(af,function(ai,aj){if(y(ai,ah)){ae=aj;return true}});return ae}function L(ag,af){var ae=[];c.each(af,function(ah){ae.push(ah[ag])});return ae}function G(ah,ag){if(ah.state){for(var ae in ah){j.html("."+ae,ah[ae])}j.removeAttr("#btn","disabled");var af=c.one("#sellerCode").val()}else{j.html(".sellerInfo","");j.attr("#btn","disabled","disabled")}return[ah.message,ah.state]}if(c.one("form")){var N=new c.Validation("form",{style:"text"});this.isFormValidate=function(){return N.isValid()&&Q()};var v=N.get("sellerCode");if(!S){var I=c.one("#sellerCode");if(I&&I.val()){G({state:true})}if(I){I.on("change",function(){Y.setResult([]);j.val("#"+m,"")})}}var R=function(ae,af){v.showMessage(ae,af)};var t={url:"checkSellerCode.json",success:G};if(v){var M=new b(v.el,t,R);v.addRule("ajax",function(af){var ae=M.check(af,"sellerCode");return G(ae,af)});i.on(v.el,"blur",function(){if(!j.val(this)){j.html(".sellerInfo","");j.attr("#btn","disabled","disabled")}})}i.on("form","submit",function(){return N.isValid()})}}KISSY.use("lpassert/calendar",function(k,l){var m=l([{selector:"#J_InOrdersDate"}])});return h},{requires:["core","1.0/uicommon","1.0/grid","1.0/dialog","lpassert/remote"]});
