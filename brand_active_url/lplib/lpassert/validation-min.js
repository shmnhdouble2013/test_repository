KISSY.add(function(d,h){var e=d.DOM,b=d.Event;h.Rule.add("dateCompare","",function(l,n,j){var i=Date.parse(e.val(j.start).replace(/\-/g,"/")),m=Date.parse(e.val(j.end).replace(/\-/g,"/"));if(!i){return j.startText?j.startText:"\u8bf7\u8f93\u5165\u6709\u6548\u7684\u5f00\u59cb\u65f6\u95f4!"}else{if(!m){return j.endText?j.endText:"\u8bf7\u8f93\u5165\u6709\u6548\u7684\u7ed3\u675f\u65f6\u95f4!"}else{if(i>m){return j.bigText?j.bigText:"\u5f00\u59cb\u65f6\u95f4\u4e0d\u80fd\u5927\u4e8e\u7ed3\u675f\u65f6\u95f4!"}else{if(j.days){var k=(m-i)/(1000*60*60*24);if(k>j.days){return j.bigText?j.bigText:"\u7ed3\u675f\u65f6\u95f4\u4e0d\u80fd\u5927\u4e8e\u5f00\u59cb\u65f6\u95f4"+j.days+"\u5929!"}}}}}});h.Rule.add("date","\u8bf7\u8f93\u5165\u6709\u6548\u7684\u65f6\u95f4!",function(j,l,i){if(i){var k=Date.parse(j.replace(/\-/g,"/"));if(!k){return l}}});h.Rule.add("cardId","\u8eab\u4efd\u8bc1\u53f7\u7801\u4e0d\u6b63\u786e",function(i,j){if(!(/^(\d{6})(18|19|20)?(\d{2})([01]\d)([0123]\d)(\d{3})(\d|x|X)?$/.test(i))){return j}});h.Rule.add("grouprequires","\u4f53\u79ef\u586b\u5199\u4e0d\u6b63\u786e\uff01",function(j,l,k){var i="";d.each(k,function(n){if(i){return}var m=e.get(n),o=e.val(m);if(!(/^\d+(\.\d+)?$/.test(o))){i=l;return}else{if(o.length>9){i="\u957f\u5ea6\u4e0d\u80fd\u5927\u4e8e9\u4e2a\u5b57\u7b26\uff01";return}}});if(i){return i}});h.Rule.add("exclude","\u4e0d\u80fd\u5305\u542b\u5173\u952e\u5b57{0}\u3002",function(k,l,j){var i="";d.each(j,function(m){if(new RegExp(m,"ig").test(k)){i=h.Util.format(l,m);return}});return i});h.Rule.add("empty","\u4e0d\u80fd\u4e3a\u7a7a\uff01",function(i,j){if(!d.trim(i)){return j}});h.Rule.add("unique","\u4e0d\u80fd\u6709\u91cd\u590d\u9879\uff01",function(l,m,i){var j=0,k=e.query(i);d.each(k,function(n){if(d.trim(l)===d.trim(e.val(n))){j++}});if(j>1){return m}});var f=h.Define.Const.enumvalidsign;function g(){return{init:function(){var j=this,n=j.target,i,k,m,l;i=e.create(j.template);m=e.get(".estate",i),k=e.get(".label",i),l=e.get(".float-tip-box",i);n.parentNode.appendChild(i);e.hide(i);e.hide(l);d.mix(j,{panel:i,estate:m,label:k});j._bindEvent(j.el,j.event,function(p){var o=j.fire("valid",{event:p.type});if(d.isArray(o)&&o.length==2){j.showMessage(o[1],o[0],p.type)}});b.on(i,"mouseenter",function(){if(j.result!=f.ok){e.show(l)}});b.on(i,"mouseleave",function(){e.hide(l)})},showMessage:function(i,o){var k=this,j=k.panel,n=k.estate,l=k.label;k.result=i;if(k.invalidClass){if(i==f.ignore&&i==f.ok){e.removeClass(k.el,k.invalidClass)}else{e.addClass(k.el,k.invalidClass)}}if(i==f.ignore){e.hide(j)}else{var m="error";if(i==f.error){m="error"}else{if(i==f.ok){m="ok"}else{if(i==f.hint){m="tip"}}}e.removeClass(n,"ok tip error");e.addClass(n,m);e.html(l,o);e.show(j)}},style:{floatTips:{template:'<span class="validation-float-tips"><span class="estate"><em class="estate-icon"></em><span class="float-tip-box"><label class="label"></label><span class="pointyTipShadow"></span><span class="pointyTip"></span></span></span></span>',event:"focus blur keyup"}}}}h.Warn.extend("floatTips",g);var a="valid-text";function c(){return{init:function(){var j=this,k=d.one(j.target),i=k.parent();j.parentNode=i},showMessage:function(j,l){var i=this,k="";i._clearMessage();if(j===f.error){k=i._getTemplate(l);new d.Node(k).appendTo(i.parentNode)}},_clearMessage:function(){var i=this,j=this.parentNode.one("."+a);if(j){j.remove()}},_getTemplate:function(i){return['<span class="',a,'"><span class="estate error"><span class="x-icon x-icon-mini x-icon-error" >!</span><em>',i,"</em></span></span>"].join("")},style:{underText:{template:"",event:"focus blur keyup"}}}}h.Warn.extend("underText",c);return h},{requires:["validation"]});
