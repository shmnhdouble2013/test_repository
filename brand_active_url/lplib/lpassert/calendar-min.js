KISSY.add(function(b){function c(g){var f=b.DOM,d=b.Event,e={};b.each(g,function(p){var k=f.get(p.selector);if(!k){return}var i=b.one(p.selector);if(i.hasAttr("readonly")){i.removeAttr("readonly")}if(!i.hasClass("ks-select-calendar")){i.addClass("ks-select-calendar")}if(p.showTime){if(!i.hasClass("calendar-time")){i.addClass("calendar-time")}}var q,h=p.showTime?"timeSelect":"select",o=p.showTime?"yyyy-mm-dd HH:MM:ss":"yyyy-mm-dd",m=p.min?a(p.min,new Date()):(p.min===0?new Date():null),n=p.max?a(p.max,new Date()):(p.max===0?new Date():null);if(p.config){q=new b.Calendar(p.selector,p.config)}else{var l=Date.parse(f.val(p.selector).replace(/\-/g,"/"));q=new b.Calendar(p.selector,{minDate:m,maxDate:n,selected:l?new Date(l):null,showTime:p.showTime,popup:true,triggerType:["click"]})}q.on(h,function(r){var s=f.get(p.selector);f.val(s,j(r.date));d.fire(s,"change");this.hide();s.focus()});if(!p.allowEdit){d.on(p.selector,"keydown",function(r){if((r.keyCode===8||r.keyCode===46)){f.val(this,"");if(q.fire){q.fire("dateclear")}}});d.on(p.selector,"valuechange",function(r){f.val(this,"")})}function j(r){return b.Date.format(r,o)}e[p.selector]=q});return e}b.extend(c,b.Base);var a=function(g,f){var e=new Date(f-0+g*86400000);e=e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate();return new Date(e)};return c},{requires:["core","calendar","./css/calendar.css"]});
