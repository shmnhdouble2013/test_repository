KISSY.add(function(c){var e=c.DOM,d=c.UA,b=c.Node;function a(Y){var v="lp-selected",al="ks-hidden",ao="lp-last",m="lp-hover",q="nav-item",W="nav-item-mask",ac="lp-second-slib-con",an="lp-second-slib",X="lp4-tab-item",B="lp-collapse",o="data-index",ag=145,J=0,ap=1,p="http://www.atpanel.com/ued.1.1.2?type=9&_gm:id=lp_xiaoqing.dong",x=c.one("#J_mainNav"),ak=x.children(".nav-item"),N=c.one("#J_mainNavContent"),k=null,I=null,z=Y.urlSuffix||".htm",V=null,ab=null,aa=[],L=Y.modulesConfig,D=K()<50;ag=n();M(L);h();k=N.children("."+X);ad();c.each(ak,function(at,ar){c.one(at).on("click",function(){var au=c.one(this);if(au.hasClass(v)){return}l(ar,au)}).on("mouseenter",function(){c.one(this).addClass("lp-hover")}).on("mouseleave",function(){c.one(this).removeClass("lp-hover")})});x.on("mouseover",function(au){var at=i(au.target),ar=c.one(at),av=null;if(ar&&ar.hasClass(ao)&&V){av=ar.offset();if(!D){av.top+=7}else{av.top+=39}av.left+=7;u(av)}}).on("mouseout",function(at){var ar=at.toElement;if(ar&&V&&(!V.contains(ar)&&ar!==V[0])){ae()}});if(V){V.delegate("mouseenter","."+q,function(at){var ar=c.one(at.currentTarget);ar.addClass(m)});V.delegate("mouseleave","."+q,function(at){var ar=c.one(at.currentTarget);ar.removeClass(m)})}c.Event.delegate(document,"click",".page-lnk",function(aw){aw.preventDefault();var au=c.one(aw.currentTarget),ay=au.attr("data-id")||au.attr("id"),at=au.attr("data-page"),ax=au.attr("title"),av=au.attr("data-module"),ar=au.attr("data-href");if(window.pageManger){if(at){window.pageManger.redirectPage(av,at)}else{window.pageManger.openPage(av,ay,ax,ar)}}});var H={};window.pageManger={openPage:function(au,at,ay,ar,aB,aA){au=au||ah();var av=S(au);if(av){var aw=av.tab,ax=aw.getActiveTab(),az=ax?ax.get("tabId"):null;if(au!=ah()){l(R(au))}aw.addTab({tabId:at,tabName:ay,conUrl:ar,sourceId:az,isReload:true});window.pageManger.tabBindEvent(au,at,"refresh",aB);if(aA){ax.closeTab()}y(au,ap,ar)}},redirectPage:function(ay,az,at,au,aw){ay=ay||ah();var av=S(ay);if(ay!=ah()){l(R(ay))}if(av){var ax=av.tab,ar=ax.getActiveTab();s(ay,az,au,aw);if(at&&ar){ar.closeTab()}}},closePage:function(av,at){av=av||ah();var au=S(av);if(au){var ar=at?au.tab.getTab(at):au.tab.getActiveTab();if(ar){ar.closeTab()}}return at},refreshSource:function(av){av=av||ah();var at=S(av);if(at){var au=at.tab;var ar=au.getActiveTab();if(au.getSourceTab()){ar.fire("refresh",{tabPage:ar})}}},setPageTitle:function(ax,aw,au,at){aw=aw||ah();var av=S(aw);if(av){var ar=au?av.tab.getTab(au):av.tab.getActiveTab();if(ar){ar.resetTitle({title:ax,load:at})}}return ar},tabBindEvent:function(ax,at,av,aw){ax=ax||ah();var au=S(ax);if(au){var ar=at?au.tab.getTab(at):au.tab;if(ar&&av&&aw){ar.on(av,aw)}}},tabDetachEvent:function(ax,at,av,aw){ax=ax||ah();var au=S(ax);if(au){var ar=at?au.tab.getTab(at):au.tab;if(ar&&av&&aw){ar.detach(av,aw)}}},tabFireEvent:function(aw,at,av){aw=aw||ah();var au=S(aw);if(au){var ar=au.tab.getTab(at);if(ar&&av){ar.fire(av,{tabPage:ar})}}},getTabId:function(av,aw){av=av||ah();var au=S(av),ar=null,at=null;if(au){if(!aw||aw==="active"){ar=au.tab.getActiveTab()}else{if(aw==="source"){ar=au.tab.getSourceTab()}}if(ar){at=ar.get("tabId")||null}}return at},bindTopEvent:function(au,ar,at,av){if(KISSY.LP[au]){KISSY.LP[au].on(ar,at);c.one(av).on("unload",function(){c.log("unload");KISSY.LP[au].detach(ar,at)})}},menuTreeData:c.clone(L)};U();function y(au,at,ar){}function n(){var ar=ak[0];if(ar){return c.one(ar).outerWidth()}return 100}function K(){var ar=ak[0];if(ar){return c.one(ar).outerHeight()}return 50}function M(ar){if(!c.isArray(ar)){return}var at=P(ar);while(at!==-1){ar.splice(at,1);at=P(ar)}}function P(at){var ar=-1;c.each(at,function(av,au){if(av===null||av===undefined){ar=au;return false}});return ar}function U(){var at=am();if(at){var ar=at.pageId,au=at.search;l(at.moduleId);s(I,ar,true,au)}else{if(I==null){l(0)}else{aj(I)}}}function i(ar){if(e.hasClass(ar,q)){return ar}return e.parent(ar,"."+q)}function h(){t();N.children().remove();c.each(L,function(at){var au=at.id,ar=['<li class="lp4-tab-item ks-hidden"><div class="lp4-second-nav"><div class="lp4-second-tree" id="J_',au,'Tree"></div><div class="',ac,'"><div class="',an,'"></div></div></div><div class="lp4-inner-tab" id="J_',au,'Tab"></div></li>'].join("");new c.Node(ar).appendTo(N)})}function t(){if(ak.length===0){return}var ax=ak.length,az=ai(),ay=ag,ar=ay*ax,av=0;c.each(ak,function(aB,aA){new c.Node('<div class="'+W+'"></div>').appendTo(aB);e.attr(aB,o,aA);e.removeClass(aB,ao)});if(ar<=az){return}av=parseInt(az/ay);af(ak[av-1]);aa.push(e.clone(ab,true));for(var au=av;au<ax;au++){var aw=ak[au],at=null;at=e.clone(aw,true);aa.push(at);e.addClass(aw,al)}aq()}function af(at){if(ab===at){return}var ar=null;if(ab){ar=c.one(ab).one(".lp-hide-current");e.removeClass(ab,ao);e.addClass(ab,al)}e.addClass(at,ao);e.removeClass(at,al);if(!ar){ar=new b('<span class="lp-hide-current">&nbsp;&nbsp;</span>')}ar.appendTo(c.one(at).children(".nav-item-inner"));ab=at}function aq(){if(V!==null){return}var at='<ul class="lp4-hide-list ks-hidden"></ul>',ar=new c.Node(at).appendTo("body");V=ar;c.each(aa,function(au){e.appendTo(au,V)});E()}function E(){if(V==null){return}V.on("mouseleave",function(){ae()});V.on("click",function(av){var au=i(av.target),at=null,ar=0;if(au){at=c.one(au);ar=at.attr(o);l(ar);ae()}})}function u(ar){V.css("left",ar.left);V.css("top",ar.top);V.show()}function ae(){V.hide()}function O(au){var at=null,ar=null,aw=null,av=null;c.each(aa,function(ax){if(e.attr(ax,o)==au){ar=ax}if(e.hasClass(ax,ao)){at=ax}});if(at!==ar){if(at){av=c.one(at).one(".lp-hide-current");e.removeClass(at,ao)}e.addClass(ar,ao);if(!av){av=new b('<span class="lp-hide-current">&nbsp;&nbsp;</span>')}aw=c.one(ar);av.appendTo(aw.children(".nav-item-inner"));aw.prependTo(V)}}function l(at,av){if(I!==at){var aw=g(at),au=null,ar=true;if(!T(aw)){ar=false;au=w(aw)}else{au=S(aw)}av=av||c.one(ak[at]);if(av.hasClass(al)&&ab){af(av[0]);O(at)}ak.removeClass(v);av.addClass(v);k.addClass(al);c.one(k[at]).removeClass(al);I=at;curPageId=r();aj(at,curPageId);if(!curPageId&&au.mainPage){s(at,au.mainPage)}if(d.ie===6&&!ar){au.tab.autoSetTabNavWidth()}y(aw,J)}}function s(aw,ax,ay,aB){var au=g(aw)||aw,av=S(au);if(av&&ax){av.menu.setMenuActive(ax);var aA=av.menu.getSelectedItem(),at="",ar=-1;if(aA&&aA.id===ax){at=aB?(aA.href+"?"+aB):aA.href;av.tab.addTab({tabId:aA.id,tabName:aA.text,conUrl:at,isReload:!!ay})}else{if(ax){var az=ax.replace("-","/");if(az.indexOf("/")===-1){az=au+"/"+az}if((ar=ax.indexOf("."))===-1){az+=z}at=aB?(az+"?"+aB):az;av.tab.addTab({tabId:ax,tabName:"",conUrl:at,isReload:!!ay})}}y(au,ap,at)}}function G(at,ar){return{conId:at,tabWidth:140,tabRevision:-12,conHeight:ar}}function A(at,ar){return{items:ar,collapible:true,renderTo:"#"+at}}function Q(av,ax,aA,ay){var az=this,at=new c.LP.Menu(ax),au=new c.LP.Tab(av),aB=c.one(ax.renderTo),ar=aB.next("."+ac),aw=aB.parent("."+X);if(ar){ar.on("click",function(){aw.toggleClass(B);au.resizeTab()})}if(aA){aw.addClass(B)}at.on("menuclick",function(aC){az.tab.addTab({tabId:aC.id,tabName:aC.text,conUrl:aC.href,isReload:true});y(ah(),ap,aC.href)});at.on("selectchanged",function(aC){aj(I,aC.id)});au.on("tabChanging",function(aC){az.menu.setMenuActive(aC.tabId)});az.tab=au;az.menu=at;az.mainPage=ay}function C(at){var ar=null;c.each(L,function(au){if(au.id===at){ar=au;return false}});return ar}function T(ar){return !!H[ar]}function S(at){var ar=H[at];if(!ar){ar=w(at)}return ar}function w(av){var at=C(av);if(!at){return null}var av=at.id,ar="J_"+av+"Tab",au="J_"+av+"Tree";module=new Q(G(ar,F()-35),A(au,at.menu),at.collapse,at.mainPage);H[av]=module;return module}function F(){var ar=e.viewportHeight(),at=D?70:100;return ar-at}function ai(){return e.viewportWidth()}function ad(){var ar=F();if(!D&&d.ie===7){ar+=65}c.all(".lp4-tab-item").height(ar)}function g(ar){if(L[ar]){return L[ar].id}else{return ar}}function R(at){var ar=0;c.each(L,function(av,au){if(av.id===at){ar=au;return false}});return ar}function ah(){return g(I)}function r(){var av=ah(),at=S(av),ar="";if(at){var au=at.menu.getSelectedItem();if(au){ar=au.id}}return ar}function Z(){var ar=x.children("."+v);return ar.attr(o)}function am(){var aw=location.hash,av=0,ar="",at=aw.indexOf("/"),au=null;if(!aw){return null}if(at>=0){av=aw.substring(1,at);ar=aw.substring(at+1);au=j(ar);if(au){ar=ar.replace("?"+au,"")}}else{av=aw.substring(1)}av=R(av);return{moduleId:av,pageId:ar,search:au}}function j(ar){var at=ar.indexOf("?");if(at>=0){return ar.substring(at+1)}return null}function aj(au,ar){ar=ar||"";var at=g(au),av="#"+at;if(ar){av+="/"+ar}location.hash=av}}function f(h){var g=this;h=c.merge(f.config,h);f.superclass.constructor.call(g,h);g.events=["timeup"];g._init()}f.config={speed:10000};c.extend(f,c.Base);c.augment(f,{_init:function(){var g=this,h=window.setInterval(function(){g.fire("timeup")},g.get("speed"));g.set("timer",h)},ajaxFunc:function(j,k,h){var g=this,i={type:"post",dataType:"json",success:function(l){k.call(g,l)}};h=h===undefined?false:h;if(h){i=c.merge(i,{type:"get",dataType:"jsonp",cache:false,crossDomain:true})}i=c.merge(i,j);c.io(i)}});c.namespace("LP");c.LP.Loop=f;window.mainUtil={};mainUtil.mainPage=a;return a},{requires:["core"]});
