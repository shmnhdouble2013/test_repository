KISSY.add(function(d,a){var f=d.UA,c={stroke:"StrokeColor","stroke-width":"StrokeWeight",fill:"FillColor"};function h(i){return function(){if(f.ie&&f.ie<9){return g(i)}else{return i}}}function b(i){if(f.ie&&f.ie<9){return g(i)}else{return i}}function g(i){var j={};d.each(i,function(m,l){if(c[l]){j[c[l]]=m}else{j[l]=m}});return j}var e=function(i){e.superclass.constructor.call(this,i);this._init()};e.ATTRS={nodeTypes:{value:{"1":{stroke:"#c8cbd0","stroke-width":2,fill:"#c8cbd0"},"2":{stroke:"#535c6f","stroke-width":2,fill:"#16e4d8"},"3":{stroke:"#535c6f","stroke-width":2,fill:"#ffbd3f"},"4":{stroke:"#535c6f","stroke-width":2,fill:"#f8273f"},"5":{stroke:"#626e84","stroke-width":2,fill:"#626e84"}}},activeNodeAttrs:{getter:h({stroke:"#535c6f","stroke-width":2,fill:"#16e4d8"},{FillColor:"#16e4d8",StrokeWeight:2,StrokeColor:"#535c6f"})},unstartType:{value:"1"},activeType:{value:2},completeNodeAttrs:{getter:h({fill:"#626e84"},{FillColor:"#626e84"})},completeType:{value:5},completeLineAttrs:{getter:h({stroke:"#626e84"})},workflowConfig:{setter:function(i){i=d.merge({cutline:"http://img02.taobaocdn.com/tps/i2/T1zVAjXXXaXXb_mJfL-354-29.png"},i);return i}}};d.extend(e,d.Base);d.augment(e,{_init:function(){var i=this,j=i.get("workflowConfig");i._initNodes(j.nodes);i._initLines(j.lines,j.nodes);i._initWorksflow(j)},_initLines:function(j,k){var i=this;d.each(j,function(m){var l=i._getNode(m.end,k);if(l&&l.type&&l.type!=i.get("unstartType")){m.attrs=i.get("completeLineAttrs")}})},_getNodeAttrs:function(k){var j=this,i=j.get("nodeTypes");if(!k){return i[j.get("unstartType")]}return b(i[k])},_initNodes:function(j){var i=this;d.each(j,function(k){k.attrs=i._getNodeAttrs(k.type);if(k.info){var l=i._findNode(k.x,k.y+1);if(l){k.infoPos=1}}})},_findLastX:function(){var j=this,l=j.get("workflowConfig"),k=l.nodes,i=0;d.each(k,function(m){if(m.x>i){i=m.x}});return i},_findLastY:function(){var j=this,l=j.get("workflowConfig"),k=l.nodes,i=0;d.each(k,function(m){if(m.y>i){i=m.y}});return i},_findNode:function(k,n){var j=this,m=j.get("workflowConfig"),l=m.nodes,i=null;d.each(l,function(o){if(o.x==k&&o.y==n){i=o;return false}});return i},_getNode:function(k,j){var i=null;d.each(j,function(l){if(l.id==k){i=l;return false}});return i},_initWorksflow:function(k){var i=this,m=i.get("tplName"),j=k.xCell,l=k.yCell,n;if(!k.width){k.width=(i._findLastX()+1)*j}if(!k.height){k.height=(i._findLastY()+1)*l}if(m){d.use(m,function(p,o){k.nodesTemplate=o;i._createWorkflow(k)})}else{i._createWorkflow(k)}},_createWorkflow:function(j){var i=this;workflow=f.ie&&f.ie<9?new a.vml(j):new a(j);i.set("workflow",workflow)},getWorkflow:function(){return this.get("workflow")},destroy:function(){var i=this;i.get("workflow").destroy();i.__attrVals={}}});return e},{requires:["2.0/workflow"]});
