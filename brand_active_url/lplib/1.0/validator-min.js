KISSY.add(function(e){var h=document,g=e.DOM,c=e.Event,f={},b="dependency-mismatch",a={debug:e.Config.debug,onSubmit:true,singleCheck:true,isLazy:false,rules:{},messages:{},focusCleanUp:false,focusInvalid:true,errorClass:"ks-validator-error",validClass:"ks-validator-valid",messageTag:"label",messageContainer:null,ignoreList:[],errorPlacement:null,onclick:function(j,i){if(e.one(j).val()===""){return}if(j.name in i.submitted||(j=j.parentNode).name in i.submitted){i.validate(j)}},onfocusin:function(k,j){j.lastActive=k;if(j.config.focusCleanUp){g.hide(j.getMessage(k))}var i=this,l=false;e.Validator.tipsBox(k,i,l)},onfocusout:function(k,j){if(!j.checkable(k)&&(k.name in j.submitted)&&e.one(k).val()!==""){j.validate(k)}if(!j.checkable(k)&&j.config.singleCheck&&e.one(k).val()!==""){j.validate(k)}else{if(!j.checkable(k)&&j.config.singleCheck&&g.get(k).nodeName=="SELECT"){j.validate(k)}}var i=this,l=true;e.Validator.CancelTipsBox(k,i,l)},onkeyup:function(j,i){if(Boolean(j.name)?((j.name in i.submitted)&&e.one(j).val()!==""&&Boolean(i.config.rules[j.name])&&Boolean(i.config.rules[j.name].remote)):false){i.validate(j)}},onchange:function(j,i){if(Boolean(e.UA.chrome)&&j.type=="file"){i.validate(j)}}};function d(j,i){this.form=g.get(j);this.config=e.merge(a,i);if(this.config.messageContainer){this.config.messageContainer=g.get(this.config.messageContainer)}this.lastActive=null;this.submitted={};this._init()}e.augment(d,e.EventTarget);e.augment(d,{_init:function(){if(!this.form||this.form.tagName!=="FORM"){return e.log("error: \u4f20\u5165\u7684\u4e0d\u662f\u8868\u5355\u5143\u7d20")}this._reset();this._bindEvents()},_bindEvents:function(){var i=this,j=i.config,l=i.form;function k(n,m){if(j["on"+n.type]&&(m=n.target)&&((n.type==="click"&&(i.checkable(m)||/select|option/i.test(m.nodeName)))||(/text|password|file/i.test(m.type)||/select|textarea/i.test(m.nodeName)))){j["on"+n.type].call(i,m,i)}}if(!j.isLazy){c.on(l,"click focusin focusout keyup change",k)}if(j.onSubmit){c.on(l,"submit",function(o){var n=!i.validate(),m;if(j.debug||n){o.preventDefault();i.fire("onValidateFail",{invalid:n,event:o})}if(n&&j.focusInvalid){e.each(i.errorList,function(p){if(p.element===i.lastActive){m=i.lastActive;return false}});try{(m||i.errorList[0].element).focus()}catch(o){}}i.fire("onValidateSucess",{invalid:n,event:o})})}},_getRules:function(i){var k=e.merge(this._getAttributeRules(i),this._getStaticRules(i));if(k.required){var j=k.required;delete k.required;k=e.merge({required:j},k)}return k},_getAttributeRules:function(i){var k={},j;e.each(d.methods,function(l,m){if((j=i.getAttribute(m))!==null){k[m]=j}});if(k.maxlength&&/-1|2147483647|524288/.test(k.maxlength)){delete k.maxlength}return k},_getStaticRules:function(i){return this._normalizeRule(this.config.rules[i.name])||{}},_getElmts:function(){var j=this,k=[],i={};e.each(j.form.elements,function(l){if(!(/submit|reset|image/i.test(l.type)||!l.name||l.disabled||l.name in i||j._isIgnore(l))||!j._isOption(l)){k.push(l);i[l.name]=true}});return k},_isIgnore:function(i){var j=this.config.ignoreList;if(!j.length){return false}if(i.name&&e.indexOf(i.name,j)!==-1||e.indexOf(i,j)!==-1){return true}},_reset:function(){this.successList=[];this.errorList=[]},isValid:function(){return this.errorList.length===0},validate:function(j){var i=this;j=j?i._isCheck(j):i._getElmts();i._reset();e.each(e.makeArray(j),function(k){i.submitted[k.name]=true;i._check(k)});i.updateMessages();return i.isValid()},_check:function(l){var j=d.methods,m,n,o,i,k=/\$?\{(\d+)\}/g;if(this.checkable(l)){l=this.findByName(l.name)}n=this._getRules(l);for(o in n){if(!j[o]){e.log("error: \u5bf9\u5e94\u89c4\u5219\u7684\u65b9\u6cd5"+o+"\u672a\u58f0\u660e");continue}m=this._getCustomMessage(l.name,o)||d.messages[o];if(e.isFunction(m)){m=m.call(this,n[o],l)}else{if(k.test(m)){m=d.format(m.replace(k,"{$1}"),n[o]);k.lastIndex=0}}i=j[o].call(this,l.value,l,n[o]);if(i===b){continue}if(i==="pending"){this._pending(this,l);return}if(!i){this.errorList.push({element:l,message:m,type:"error"});return}}this.successList.push({element:l,type:"success"})},updateMessages:function(){var i=this,k,j,l;e.each([].concat(i.errorList,i.successList),function(m){k=i.getMessage(m.element,m.message);j=m.type==="error";l=m.type==="pending";g[j?"addClass":"removeClass"](m.element,i.config.errorClass);g[j?"removeClass":"addClass"](m.element,i.config.validClass);if(!j&&i.config.success){typeof i.config.success==="string"?g.addClass(k,i.config.success):i.config.success(k)}if(l){k.className="loading"}})},getMessage:function(m,n){var l=this.config,k,i=l.messageTag+"."+l.errorClass,j=l.messageContainer||this.form;if(g.data(m,"ks-validator-label")){k=g.data(m,"ks-validator-label")}else{k=g.filter(i,function(p){return g.contains(j,p)&&g.attr(p,"for")===m.name})[0]}if(k){k.className=l.errorClass;if(k.getAttribute("generated")){k.innerHTML=n}}else{k=g.create("<"+l.messageTag+">",{"class":l.errorClass,"for":m.name,generated:"generated"});k.innerHTML=n;if(l.messageWrapper){var o=k;k=g.create(l.messageWrapper);k.appendChild(o)}if(l.messageContainer){l.messageContainer.appendChild(k)}else{l.errorPlacement?l.errorPlacement(k,m):m.parentNode.appendChild(k)}}g.data(m,"ks-validator-label",k);return k},checkable:function(i){return/radio|checkbox/i.test(i.type)},findByName:function(j){var k=this.form,i=null;e.each(h.getElementsByName(j),function(l){return l.form===k&&(i=l).disabled});return i},optional:function(i){return !d.methods.required.call(this,e.trim(i.value),i)&&b},getLength:function(l,j){var i=0,k=this.form;switch(j.nodeName){case"SELECT":e.each(j.options,function(m){m.selected&&i++});return i;case"INPUT":if(this.checkable(j)){e.each(h.getElementsByName(j.name),function(m){m.form===k&&m.checked&&i++});return i}}return l.length},depend:function(j,i){return this._dependTypes[typeof j]?this._dependTypes[typeof j](j,i):true},_dependTypes:{"boolean":function(i){return i},string:function(j,i){return !!$(j,i.form).length},"function":function(j,i){return j(i)}},_normalizeRule:function(j){if(typeof j=="string"){var i={};e.each(j.split(/\s/),function(k){i[k]=true});j=i}return j},_getCustomMessage:function(j,k){var i=this.config.messages[j];return i&&(typeof i==="string"?i:i[k])},_previousValue:function(i){if(g.data(i,"old")||g.data(i,"valid")){f.old=g.data(i,"old");f.valid=g.data(i,"valid");return f}f={old:null,valid:"pending"};g.data(i,"old",null);g.data(i,"valid","pending");return f},_pending:function(j,k){var i={element:k,message:"\u9a8c\u8bc1\u4e2d",type:"pending"};j.errorList.push(i)},_isOption:function(i){if(/select/i.test(i.type)){if(i.selectedIndex===-1){return null}return e.one(i)}return i},_isCheck:function(j){var i=this;if(i._isIgnore(j)){return undefined}return i._isOption(j)}});e.mix(d,{methods:{required:function(j,i,l){if(!this.depend(l,i)){return b}switch(i.nodeName){case"SELECT":var k=g.val(i);return k&&k.length>0;case"INPUT":if(this.checkable(i)){return this.getLength(j,i)>0}}return e.trim(j).length>0},minlength:function(j,i,k){return this.optional(i)||this.getLength(e.trim(j),i)>=k},maxlength:function(j,i,k){return this.optional(i)||this.getLength(e.trim(j),i)<=k},min:function(j,i,k){return this.optional(i)||j>=k},max:function(j,i,k){return this.optional(i)||j<=k},email:function(j,i){var j=e.trim(j);return this.optional(i)||/^[a-zA-Z0-9_.-]+\@([a-zA-Z0-9-]+\.)+[a-zA-Z0-9]{2,4}$/.test(j)},equalTo:function(k,j,m){var i=this,l=g.get(m);if(l){c.remove(l,"keyup");c.on(l,"keyup",function(){i.validate(j)})}return l?k===l.value:true},rangeLength:function(k,i,l){var j=this.getLength(e.trim(k),i);return this.optional(i)||(j>=l[0]&&j<=l[1])},range:function(j,i,k){return this.optional(i)||(j>=k[0]&&j<=k[1])},url:function(j,i){return this.optional(i)||/^(http|https|ftp):\/\/(([A-Z0-9][A-Z0-9_-]*)(\.[A-Z0-9][A-Z0-9_-]*)+)(:(\d+))?\/?/i.test(j)},number:function(j,i){return this.optional(i)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(j)},digits:function(j,i){return this.optional(i)||/^\d+$/.test(j)},accept:function(j,i,k){k=typeof k=="string"?k.replace(/,/g,"|"):"png|jpe?g|gif";return this.optional(i)||j.match(new RegExp(".("+k+")$","i"))},mobile_cn:function(j,i){return this.optional(i)||/^\+?(86)*0*1[3|5|6|8]\d{9}$/.test(j)},postcode_cn:function(j,i){return this.optional(i)||/^[1-9]{1}(\d+){5}$/.test(j)},digitsandline:function(j,i){return this.optional(i)||/^\d{3,4}-\d+$/.test(j)},digitsandword:function(j,i){return this.optional(i)||/^(\d|[a-zA-Z])*$/.test(j)},digitsandwordandtag:function(j,i){return this.optional(i)||(/^[A-Za-z0-9]+$/.test(j))},remote:function(l,j,m){var i=this;if(this.optional(j)){return"dependency-mismatch"}this._previousValue(j);if(f.old!==l){g.data(j,"old",l);var k={};if(e.isFunction(m.data)){k=m.data()}else{k[j.name]=encodeURIComponent(l)}m.url=m.url+"?t="+new Date().getTime();e.io({type:m.type,url:m.url,data:k,dataType:"json",success:function(p,q,o){if(o.status===200){f.valid=p;g.data(j,"valid",p);if(f.valid){i.successList[0]={element:j,type:"success"};i.errorList.shift();i.updateMessages()}else{var n=i._getCustomMessage(j.name,"remote")||e.Validator.messages.remote;i.errorList[0]={element:j,message:n,type:"error"};i.updateMessages()}}}});return"pending"}return f.valid}},messages:{required:"\u8be5\u9879\u5fc5\u586b\u9879",minlength:"\u8981\u6c42\u4e3a\u6700\u5c11{0}\u5b57",maxlength:"\u8981\u6c42\u4e3a\u6700\u591a{0}\u5b57",min:"\u8981\u6c42\u4e3a\u5927\u4e8e\u7b49\u4e8e{0}\u7684\u6570\u5b57",max:"\u8981\u6c42\u4e3a\u5c0f\u4e8e\u7b49\u4e8e{0}\u7684\u6570\u5b57",remote:"\u9a8c\u8bc1\u672a\u901a\u8fc7",postcode_cn:"\u90ae\u653f\u7f16\u7801\u683c\u5f0f\u9519\u8bef",mobile_cn:"\u624b\u673a\u53f7\u7801\u683c\u5f0f\u9519\u8bef",digitsandline:"\u53ea\u80fd\u7528\u6570\u5b57\u52a0-",email:"Email\u5730\u5740\u683c\u5f0f\u9519\u8bef",equalTo:"\u4e24\u6b21\u8f93\u5165\u7684\u5185\u5bb9\u4e0d\u76f8\u540c",rangeLength:"\u8981\u6c42\u4e3a{0}-{1}\u5b57",range:"\u8981\u6c42\u4e3a\u4ecb\u4e8e{0}-{1}\u4e4b\u95f4\u7684\u6570\u5b57",url:"URL\u5730\u5740\u683c\u5f0f\u9519\u8bef",number:"\u8981\u6c42\u5fc5\u987b\u662f\u6570\u5b57",digits:"\u8981\u6c42\u5fc5\u987b\u662f\u6574\u6570",accept:"\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684\u6269\u5c55\u540d\u5f97\u503c",digitsandword:"\u53ea\u80fd\u7528\u6570\u5b57\u52a0\u82f1\u6587\u5b57\u6bcd",digitsandwordandtag:"\u6570\u5b57\u82f1\u6587\u5728\u4e00\u8d77\uff0c\u5355\u72ec\u7684\u6570\u5b57\u3001\u82f1\u6587\u3001\u7b26\u53f7\u4e0d\u884c"},setDefaults:function(i){a=e.merge(a,i);return this},addMethod:function(i,k,j){this.methods[i]=k;this.messages[i]=j||a.messages&&a.messages[i];return this},format:function(i,j){if(arguments.length==1){return function(){var k=e.makeArray(arguments);k.unshift(i);return d.format.apply(this,k)}}if(arguments.length>2&&!e.isArray(j)){j=e.makeArray(arguments).slice(1)}e.each(e.makeArray(j),function(l,k){i=i.replace(new RegExp("\\{"+k+"\\}","g"),l)});return i},getID:function(l){var p={},r={},k={};for(var q in l.rules){var j=e.one("#"+q).attr("name");r[j]=l.rules[q]}for(var i in l.messages){var o=e.one("#"+i).attr("name");k[o]=l.messages[i]}p.rules=r;p.messages=k;return e.merge(l,p)},tipsBox:function(k,i,l){var j=e.one(k).attr("class");if(k.nodeName=="SELECT"||k.type=="file"||k.type=="checkbox"||k.type=="radio"){return}if(e.one(k).val()===""&&i.config.tips[k.id]){e.one(i.getMessage(k,i.config.tips[k.id])).html("&nbsp;").removeAttr("class");i.config.tipsPlacement(i.getMessage(k,i.config.tips[k.id]));return}if(!i.config.singleCheck&&l&&j!=i.config.errorClass&&j!=i.config.validClass){e.one(i.getMessage(k,i.config.tips[k.id])).html("&nbsp;").removeAttr("class");return}},CancelTipsBox:function(k,i,l){var j=e.one(k).attr("class");if(i.config.tips[k.id]==undefined){return}if(k.nodeName=="SELECT"||k.type=="file"||k.type=="checkbox"||k.type=="radio"){return}if(!g.hasClass(k,i.config.errorClass)&&!g.hasClass(k,i.config.validClass)){e.one(i.getMessage(k,i.config.tips[k.id])).html("&nbsp;").removeAttr("class");return}if(g.hasClass(k,i.config.validClass)&&e.one(k).val()===""){e.one(i.getMessage(k,i.config.tips[k.id])).html("&nbsp;").removeAttr("class");return}if(g.hasClass(k,i.config.errorClass)&&e.one(k).val()===""){e.one(i.getMessage(k,i.config.tips[k.id])).html("&nbsp;").removeAttr("class");return}}});e.namespace("Validator");e.Validator=d},{requires:["core"]});
