KISSY.add("linkselect",function(c){var e=c.DOM,b=c.Event,a={defval:{text:"\u8bf7\u9009\u62e9",val:""},rootid:0};function g(j,k,i){var h=this;h.config=c.merge(a,i||{});h.selManager=new f();h.data=k;c.each(j,function(n,m){n=e.get(n);if(n){var l=h.selManager.add(n,m);b.on(n,"change",function(o){h._change(l,e.val(o.target))})}});h._render(h.selManager.get(0),h.config.rootid)}c.augment(g,c.EventTarget,{_change:function(h,j){var i=this,k=i.selManager.get(h.index+1);if(k){i._render(k,j);i._change(k,-1)}},_getData:function(k,i){var h=this,l=h.config.remote,j=[];if(i===-1||i===""||!k.data){return}if(k.data[i]){return k.data[i]}var m=k.data[i]=[];if(l){if(i===0&&h.data.length>0){return}c.io({type:"POST",url:l.url,dataType:"json",data:{parent:i},success:function(o,p,n){c.each(o.data,function(q){m.push([q[1],q[0]])});h._render(k,i)},error:function(o,p,n){c.log(d,p,n)}})}c.each(h.data,function(o,n){if(o[1]==i){m.push([n,o[0]]);j.push([n,o[0]])}});return j},_render:function(l,j,n){var i=this,h=i.config,m=l["0"],k=i._getData(l,j)||[];if(!m){return}m.options.length=0;if(k&&k.length>0&&h.defval){m.options[m.options.length]=new Option(h.defval.text,h.defval.val)}c.each(k,function(o){m.options[m.options.length]=new Option(o[1],o[0])});if(n){e.val(m,n)}},focus:function(k,l){var i=this,j=i.selManager.get(k),h=null;if(!j){return}i._change(j,"");(function(m,n){if(!m){return}if(m.index==0){i._render(m,i.config.rootid,n)}else{h=i.data[n];if(h){i._render(m,h[1],n);arguments.callee(i.selManager.get(m.index-1),h[1])}}})(j,l);if(i.selManager.get(j.index+1)){i._render(i.selManager.get(j.index+1),l)}}});function f(){var h=[];this.add=function(k,j){var i=h.length;h[i]={index:j,"0":k,data:{}};return h[i]};this.get=function(i){var j=null;if(c.isNumber(i)&&i<=h.length){return h[i]}c.each(h,function(k){if(k["0"]==i){j=k;return false}return j})}}c.LinkSelect=g;return g});
