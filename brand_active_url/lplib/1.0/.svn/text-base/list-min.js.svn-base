KISSY.add(function(c){var a=c.Node,d=c.DOM,e="list-element";function b(g){var f=this;g=g||{};if(!g.renderTo){throw"please assign the id of rendered Dom!"}b.superclass.constructor.call(f,g);f._init()}c.extend(b,c.Base);c.augment(b,{showData:function(g){var f=this;f._clearData();f.fire("beforeshow",{data:g});c.each(g,function(i,h){f._createItem(i,h)});f.fire("aftershow",{data:g})},_appendData:function(g){var f=this;c.each(g,function(i,h){f._createItem(i,h)})},_clearData:function(h){var g=this,f=g.get("body");c.one(f).children().remove()},_removeData:function(i){var g=this,f=g.get("body"),h=c.one(f).children();c.each(h,function(j){var k=d.data(j,e);if(k&&c.inArray(k,i)){g.fire("itemremoved",{data:k,item:j});d.remove(j)}})},_createItem:function(k,i){var g=this,f=g.get("body"),h='<li class="list-item">'+c.substitute(g._getListItemTemplate(),k)+"</li>",j=new a(h).appendTo(f);j.data(e,k);g.fire("itemcreated",{data:k,item:j[0]});return j},_getListItemTemplate:function(){return this.get("template")},_init:function(){var f=this;f._initDom();f._initEvent();f._initDataEvent();f._initData()},_initData:function(){var f=this,g=f.get("store"),i=f.get("loadMask"),h=f.get("el");if(i){i=new c.LP.LoadMask(h,{msg:"Loading..."});f.set("loadMask",i)}if(g&&g.autoLoad){g.load()}},_initDom:function(){var l=this,k=l.get("renderTo"),f=d.get("#"+k),g=l.get("width"),p=l.get("height"),o=['<div id="',k+"list",'" class="list-panel"><div id="',k+"tbar",'" class="list-bar list-tbar"></div><div class="list-view"><ul class="list-content"></ul></div><div  id="',k+"bbar",'"class="list-bar list-bbar"></div>'].join(""),h=new a(o).appendTo(f),m=h.one(".list-view"),n=h.one(".list-tbar"),i=h.one(".list-bbar"),j=h.one(".list-content");l.set("el",h);l.set("view",m);l.set("body",j);l.set("tbarEl",n);l.set("bbarEl",i);l._initBar();l._setSize(g,p)},_initEvent:function(){},_initDataEvent:function(){var f=this,g=f.get("store");if(g){g.on("beforeload",function(){var h=f.get("loadMask");if(h){h.show()}});g.on("load",function(){var h=g.getResult(),i=f.get("loadMask");f.showData(h);if(i){i.hide()}});g.on("addrecords",function(h){var i=h.data;f.appendData(i)});g.on("removerecords",function(h){var i=h.data;f.removeData(i)});g.on("exception",function(){var h=f.get("loadMask");if(h){h.hide()}})}},_initBar:function(){var n=this,l=n.get("renderTo"),o=n.get("tbar"),j=n.get("bbar"),p=n.get("store"),m=0,g=null,r=null,q=null,h=null;function f(t,u){var s=c.merge(t,{renderTo:u});if(p&&!s.store){s.store=p}return new c.LP.PaggingBar(s)}function k(s,u){var t=c.merge(s,{renderTo:u});return new c.LP.ButtonBar(t)}function i(s,t){if(s.pageSize){g=f(s,l+t+"bar");n.set(t+"paggingBar",g);m=s.pageSize}if(s.buttons){r=k(s,l+t+"bar");n.set(t+"buttonBar",r)}}if(o){i(o,"t")}if(j){i(j,"b")}if(m&&p){h=p.params;if(!h.start){h.start=0;h.pageIndex=0}if(!h.limit||h.limit!==m){h.limit=m}}},_setSize:function(j,g){var f=this,i=f.get("el"),h=f.get("view"),l=f.get("tbarEl"),k=f.get("bbarEl");i.width(j);i.height(g);h.width(j-2);h.height(g-l.height()-k.height()-2)},destroy:function(){var f=this,g=f.get("el");g.remove();f.detach();f.__attrVals={}}});c.LP.List=b},{requires:["core","./uicommon","./bar","./css/list.css"]});
