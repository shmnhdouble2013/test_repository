KISSY.add(function(b){var e=b.DOM,a=b.Event,g=window,c=b.UA;b.LP=b.namespace("LP");b.mix(b.LP,{version:1,mask:function(){var k=b.one("body"),o=k.height(),j=e.viewportHeight(),h=o>j?o:j,l=b.LP.maskElement(k),n=null;function i(){var q=e.viewportHeight(),p=o>q?o:q;l.height(p)}function m(){if(n){clearTimeout(n)}n=setTimeout(i,300)}l.height(h);a.on(g,"resize",m);l.data("reszieFunc",m)},unmask:function(){var h=b.one("body"),j=h.children(".lp-el-mask"),i=j.data("reszieFunc");if(i){a.remove(g,"resize",i);j.data("reszieFunc",null)}b.LP.unmaskElement(h)},maskElement:function(l,j,m){var q=b.one(l),h=q.getDOMNode(),i=b.one(".lp-el-mask",h),r=null,o=null,p=null,k=null;if(!i){i=b.one(e.create('<div class="lp-el-mask"></div>')).appendTo(h);q.addClass("x-masked-relative x-masked");if(c.ie===6){i.height(q.height())}if(j){r=['<div class="lp-el-mask-msg"><div>',j,"</div></div>"].join("");o=b.one(e.create(r)).appendTo(h);if(m){o.addClass(m)}try{p=(q.height()-o.height())/2;k=(q.width()-o.width())/2;o.css({left:k,top:p})}catch(n){}}}return i},unmaskElement:function(j){var h=b.one(j),i=h.children(".lp-el-mask-msg"),k=h.children(".lp-el-mask");if(i){i.remove()}if(k){k.remove()}h.removeClass("x-masked-relative x-masked")},isInView:function(n){var l=n.left,k=n.top,i=e.viewportWidth(),h=e.viewportHeight(),j=e.scrollTop(),m=e.scrollLeft();if(l<m||l>m+i){return false}if(k<j||k>j+h){return false}return true},isInVerticalView:function(j){var h=e.viewportHeight(),i=e.scrollTop();if(j<i||j>i+h){return false}return true},isInHorizontalView:function(i){var h=e.viewportWidth(),j=e.scrollLeft();if(i<j||i>j+h){return false}return true}});b.LP.Format=(function(){return{dateRenderer:function(j){if(!j){return""}if(b.isString(j)){return j}var h=null;try{h=new Date(j)}catch(i){return""}if(!h||!h.getFullYear){return""}return b.Date.format(j,"yyyy-mm-dd")},datetimeRenderer:function(j){if(!j){return""}if(b.isString(j)){return j}var h=null;try{h=new Date(j)}catch(i){return""}if(!h||!h.getFullYear){return""}return b.Date.format(j,"yyyy-mm-dd HH:MM:ss")},cutTextRenderer:function(h){return function(i){i=i||"";if(i.toString().length>h){return i.toString().substring(0,h)+"..."}return i}},enumRenderer:function(h){return function(i){return h[i]||""}},multipleItemsRenderer:function(i){var h=b.LP.Format.enumRenderer(i);return function(k){var j=[];if(!k){return""}if(b.isArray(k)){k=k.toString().split(",")}b.each(k,function(l){j.push(h(l))});return j.join(",")}},moneyCentRenderer:function(h){if(b.isString(h)){h=parseFloat(h)}if(b.isNumber(h)){return(h*0.01).toFixed(2)}return h}}}());function d(j,i){var h=this;h.el=j;d.superclass.constructor.call(h,i);h._init()}b.extend(d,b.Base);b.augment(d,{msg:"Loading...",msgCls:"x-mask-loading",disabled:false,_init:function(){var h=this;h.msg=h.get("msg")||h.msg},disable:function(){this.disabled=true},enable:function(){this.disabled=false},onLoad:function(){b.LP.unmaskElement(this.el)},onBeforeLoad:function(){if(!this.disabled){b.LP.maskElement(this.el,this.msg,this.msgCls)}},show:function(){this.onBeforeLoad()},hide:function(){this.onLoad()},destroy:function(){this.el=null}});b.LP.LoadMask=d;function f(i){var h=this;i=i||{};i=b.merge({root:"rows",totalProperty:"results",dataType:"json",autoLoad:false,sortInfo:{field:"",direction:"ASC"},proxy:{method:"post"},params:{},remoteSort:false,matchFunction:function(k,j){return k===j},compareFunction:function(k,j){if(k===undefined){k=""}if(j===undefined){j=""}if(b.isString(k)){return k.localeCompare(j)}if(k>j){return 1}else{if(k===j){return 0}else{return -1}}}},i);b.mix(h,i);b.mix(h,{hasLoad:false,resultRows:[],newRecords:[],modifiedRecords:[],deletedRecords:[],rowCount:0,totalCount:0});h.events=["acceptchanges","load","beforeload","beforeProcessLoad","addrecords","exception","removerecords","updaterecord","localsort"];h._init()}b.augment(f,b.EventTarget);b.augment(f,{acceptChanges:function(){var h=this;h._clearChanges();h.fire("acceptchanges")},add:function(l,j,i){var h=this,k=[];i=i||h._getDefaultMatch();if(!b.isArray(l)){l=[l]}b.each(l,function(m){if(!j||!h.contains(m,i)){h._addRecord(m);k.push(m);h.newRecords.push(m);h._removeFrom(m,h.deletedRecords);h._removeFrom(m,h.modifiedRecords)}});h.fire("addrecords",{data:k})},clear:function(){var h=this;h.setResult([])},compare:function(m,l,k,j){var h=this,i=1;k=k||h.sortInfo.field;j=j||h.sortInfo.direction;if(!k||!j){return 1}i=j==="ASC"?1:-1;return this.compareFunction(m[k],l[k])*i},contains:function(h,i){return this.findIndexBy(h,i)!==-1},findIndexBy:function(l,k){var i=this,h=-1,j=this.resultRows;k=k||i._getDefaultMatch();if(b.isUndefined(l)||b.isNull(l)){return -1}b.each(j,function(m,n){if(k(l,m)){h=n;return false}});return h},find:function(l,k,j){var h=null,i=this.resultRows;b.each(i,function(m,n){if((j&&j(m[l],k))||m[l]===k){h=m;return false}});return h},findByIndex:function(h){return this.resultRows[h]},findAll:function(l,k,j){var h=[],i=this.resultRows;b.each(i,function(m,n){if((j&&j(m[l],k))||m[l]===k){h.push(m)}});return h},findNextRecord:function(i){var h=this,j=h.findIndexBy(i);if(j>=0){return h.findByIndex(j+1)}return undefined},load:function(h){this._loadData(h)},getResult:function(){return this.resultRows},getCount:function(){return this.resultRows.length},getNewRecords:function(){return this.newRecords},getModifiedRecords:function(){return this.modifiedRecords},getDeletedRecords:function(){return this.deletedRecords},getTotalCount:function(){return this.totalCount},remove:function(j,i){var h=this,k=[];i=i||h._getDefaultMatch();if(!b.isArray(j)){j=[j]}b.each(j,function(n){var m=h.findIndexBy(n,i),l=h._removeAt(m);if(!b.inArray(l,h.newRecords)&&!b.inArray(l,h.deletedRecords)){h.deletedRecords.push(l)}h._removeFrom(l,h.newRecords);h._removeFrom(l,h.modifiedRecords);k.push(l)});h.fire("removerecords",{data:k})},setResult:function(i){i=i||[];var h=this;h.resultRows=i;h.rowCount=i.length;h.totalCount=i.length;h._sortData();h.fire("load",h.oldParams)},setValue:function(o,n,m,l){var i=o,h=this,k=null,j=null;if(l){k=h._getDefaultMatch();j=h.findIndexBy(o,k);if(j>=0){i=this.resultRows[j]}}i[n]=m;if(!b.inArray(i,h.newRecords)&&!b.inArray(i,h.modifiedRecords)){h.modifiedRecords.push(i)}h.fire("updaterecord",{record:i,field:n,value:m})},sort:function(j,i){var h=this;h.sortInfo.field=j||h.sortInfo.field;h.sortInfo.direction=i||h.sortInfo.direction;if(h.remoteSort){this.load()}else{h._sortData(j,i);h.fire("localsort",{field:j,direction:i})}},update:function(m,l){var i=m,h=this,k=null,j=null;if(l){k=h._getDefaultMatch();j=h.findIndexBy(m,k);if(j>=0){i=this.resultRows[j]}}i=b.mix(i,m);if(!b.inArray(i,h.newRecords)&&!b.inArray(i,h.modifiedRecords)){h.modifiedRecords.push(i)}h.fire("updaterecord",{record:i})},destroy:function(){var h=this;h.detach();h=null},_addRecord:function(h,j){var i=this.resultRows;if(b.isUndefined(j)){j=i.length}i[j]=h},_clearChanges:function(){var h=this;h.newRecords.splice(0);h.modifiedRecords.splice(0);h.deletedRecords.splice(0)},_loadData:function(l){var h=this,j=l||{},k=null;function i(o,n,m){h.resultRows=o;h.rowCount=n;h.totalCount=m}h.fire("beforeload");j=b.merge(h.oldParams,h.sortInfo,j);h.oldParams=j;k=h.proxy.method==="post"?j:(j?b.param(j):"");b.ajax({cache:false,url:h.proxy.url,dataType:h.dataType,type:h.proxy.method,data:k,success:function(q,r,p){h.fire("beforeProcessLoad",{data:q});var o=[],n=0,m=0;if(q.hasError){i(o,n,m);h.fire("exception",{error:q.error});return}if(b.isString(q)){q=b.json.parse(q)}if(b.isArray(q)||b.isObject(q)){if(b.isArray(q)){o=q;n=o.length;m=n}else{if(q){o=q[h.root];if(!o){o=[]}n=o.length;m=parseInt(q[h.totalProperty],10)}}}i(o,n,m);if(!h.remoteSort){h._sortData()}h.fire("load",j);h._clearChanges()},error:function(m,o,n){i([],0,0);h.fire("exception",{error:o,responseText:n.responseText})}})},_removeAt:function(j,k){if(j<0){return}var i=k||this.resultRows,h=i[j];i.splice(j,1);return h},_removeFrom:function(i,k){var h=this,j=b.indexOf(i,k);if(j>=0){h._removeAt(j,k)}},_sortData:function(j,i){var h=this;j=j||h.sortInfo.field;i=i||h.sortInfo.direction;if(!j||!i){return}h.resultRows.sort(function(l,k){return h.compare(l,k,j,i)})},_getDefaultMatch:function(){return this.matchFunction},_init:function(){var h=this;h.oldParams=h.params||{};if(!h.proxy.url){h.proxy.url=h.url}h.resultRows=[]}});b.LP.Store=f;b.LP.FormHelpr={serialize:function(h){return b.param(b.LP.FormHelpr.serializeToObject(h))},serializeToObject:function(l){var k=b.makeArray(l.elements),m=null,i=[],j=null,h={};m=b.filter(k,function(n){return(n.id||n.name)&&!n.disabled&&(n.checked||/select|textarea/i.test(n.nodeName)||/text|hidden|password/i.test(n.type))});j=b.filter(k,function(n){return(n.id||n.name)&&!n.disabled&&(/checkbox/i.test(n.type))});b.each(m,function(o){var q=b.one(o).val(),n=o.name||o.id,p=q==null?{name:n,value:""}:b.isArray(q)?b.map(q,function(s,r){return{name:n,value:s}}):{name:n,value:q};if(p){i.push(p)}});b.each(i,function(o){var p=h[o.name],n=[];if(!p){h[o.name]=o.value}else{if(b.isArray(p)){p.push(o.value)}else{n.push(p);n.push(o.value);h[o.name]=n}}});b.each(j,function(o){var n=o.name||o.id;if(!h.hasOwnProperty(n)){h[n]=""}});return h}}},{requires:["core","calendar","./css/uicommon.css"]});
