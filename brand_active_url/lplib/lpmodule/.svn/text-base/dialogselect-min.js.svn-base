KISSY.add(function(e){var l=e.DOM,k=e.Event;var j='<input class="form-field-text" type="text" readonly="readonly"/>',h='<div class="ks-hidden"></div>',d="handle",f="temp",g="select",i=55,a=130,c=", ";function b(n){var m=this;n=e.merge(b.config,n);if(!n.renderTo||!l.get("#"+n.renderTo)){throw"please assign the id of render Dom!"}b.superclass.constructor.call(m,n);m._init()}b.config={renderTo:null,resultId:null,columns:[],width:250,height:250,data:[],checkable:true,mainIndex:null,textIndex:null,title:"\u8bf7\u9009\u62e9",groupSelectConfig:{}};e.extend(b,e.Base);e.augment(b,{showSelect:function(){var m=this;m._initDialog();m._initGroupSelect()},destroy:function(){var m=this,p=m.get("handleEl"),q=m.get("tempEl"),o=m.get("groupSelect"),n=m.get("selectDialog");p.detach().remove();o.destroy();n.destroy();q.remove();m.detach()},_init:function(){var m=this,n=e.guid("J_LP_");m.set("id",n);m._initDom();m._initEvent();m._initSelectResult()},_initDom:function(){var m=this;m._initHandleDom();m._initTempDom()},_initHandleDom:function(){var m=this,p=m.get("id"),n=e.one("#"+m.get("renderTo")),o=new e.Node(j);o.attr("id",p+d);n.append(o);m.set("handleEl",o)},_initTempDom:function(){var m=this,o=m.get("id"),n=new e.Node(h);n.attr("id",o+f);n[0].innerHTML='<div><div class="dialog-select" id="'+o+g+'"></div></div>';e.one(document.body).append(n);m.set("tempEl",n)},_initEvent:function(){var m=this,n=m.get("handleEl");n.on("click",function(){m.showSelect()});m.on("dialogOk",function(){m._setSelectResult();m.get("selectDialog").close()})},_initDialog:function(){var m=this,o=m.get("selectDialog")||null,n;if(o){o.show();return}n={title:m.get("title"),width:m.get("width")+i,height:m.get("height")+a,mask:true,scroll:true,collapsible:false,maximizable:false,resizable:false,drag:true,buttonPosition:"center",contentID:m.get("id")+f,buttonZone:true,isDestroy:false,buttons:[{text:"\u786e\u5b9a",eventType:"click",handler:function(){m.fire("dialogOk")}},{text:"\u53d6\u6d88",eventType:"click",handler:function(){this.close()}}]};o=new e.LP.Dialog(n);o.show();m.set("selectDialog",o)},_initGroupSelect:function(){var m=this,n=m.get("groupSelect")||null;if(n){return}var p=m.get("id"),o=m.get("groupSelectConfig");o=e.merge({renderTo:p+g,resultId:m.get("resultId"),gridColumns:m.get("columns"),gridWidth:m.get("width"),gridHeight:m.get("height"),sourceData:m.get("data"),isTarget:false,checkable:m.get("checkable"),mainIndex:m.get("mainIndex"),isSearch:false,sourceTip:""},o);n=new e.LP.GroupSelect(o);m.set("groupSelect",n)},_setSelectResult:function(){var m=this,n=m.get("groupSelect"),o=null;if(n){o=m.get("groupSelect").getSourceSelectedData()}m._updateSelectResult(o)},_initSelectResult:function(){var m=this,n=e.one("#"+m.get("resultId"));data=null;if(n&&!!n.val()){data=e.JSON.parse(n.val()).result||null}m._updateSelectResult(data)},_updateSelectResult:function(p){var m=this,o=m.get("handleEl"),n=m.get("textIndex")||m.get("mainIndex"),r=[],q="";if(p&&p.length>0){e.each(p,function(s){r.push(s[n])});q=r.join(c)}o.val(q)}});e.namespace("LP");e.LP.DialogSelect=b},{requires:["1.0/dialog","lpmodule/groupselect-v2","lpmodule/css/module.css"]});
