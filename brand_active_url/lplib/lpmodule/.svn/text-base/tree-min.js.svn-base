KISSY.add("lpmodule/tree/base",function(c,e){var d=c.DOM,a=c.Event;function b(g){var f=this;g=c.merge(b.config,g);if(!g.renderTo||!d.get("#"+g.renderTo)){throw"please assign the id of render Dom!"}b.superclass.constructor.call(f,g);f.events=["load","searchTree","resultPush","resultPop","resultUpdate","beforeDestroy","loadTree","initData","beforeReload","loadFinished"];f._init()}b.config={renderTo:null,resultId:null,resultType:"result",store:null,url:null,idKey:null,param:{},data:[],isJsonp:false,storeConfig:{}};c.extend(b,c.Base);c.augment(b,{storeLoad:function(i,h){var f=this,g=f.getStore();if(i){if(c.isArray(i)){g.setTreeData(i)}else{g.load(i,null,null,h)}}else{g.initLoad()}},reload:function(h){var f=this,g=f.getResultManage();g.length=0;f.fire("beforeReload");f.set("isInit",false);f.storeLoad(h,true)},getStore:function(){return this.get("store")},searchTree:function(h){var f=this,g=f.getStore();return g.searchTree(h)},getResultManage:function(){return this.get("resultManage")},getIdFromResult:function(){var f=this,g=null;g=f.traverseResult(function(h){return h[h.length-1].id});return g},getValueFromResult:function(){var f=this,g=null;g=f.traverseResult(function(h){return h[h.length-1].value});return g},getPathFromResult:function(){var f=this,g=null;g=f.traverseResult(function(h){var i=[];c.each(h,function(j){i.push(j.id)});return i});return g},getValuePathFromResult:function(){var f=this,g=null;g=f.traverseResult(function(h){var i=[];c.each(h,function(j){i.push(j.value)});return i});return g},getValueStrFromResult:function(){var g=this,f=null,h=" > ";f=g.traverseResult(function(i){var j=[];c.each(i,function(l){var k=l.value;j.push(k)});return j.join(h)});return f},initData:function(){var f=this,g=f.getIdFormResultInput();f.fire("initData",{id:g});return g},getIdFormResultInput:function(){var h=this,k=h.get("resultInput"),i=h.get("resultType").split(" "),g=null,j=null,f;if(k){g=c.JSON.parse(k.val());if(g!==null){if(c.inArray("result",i)){j=h.traverseResult(function(l){return l[l.length-1].id},g.result)}else{if(c.inArray("id",i)){j=g.id}else{if(c.inArray("path",i)){j=h.traverseResult(function(l){return l[l.length-1]},g.path)}}}}}return j},isBlankResult:function(h){var f=this,i=h||f.getResultManage(),g=false;if(i.length===0){g=true}return g},isLeafResult:function(i){var f=this,j=i||f.getResultManage(),g=false,h=null;h=f.traverseResult(function(k){return k[k.length-1].isleaf});if(c.isBoolean(h)){g=h}else{if(g===null){g=false}else{if(c.isArray(h)){g=c.reduce(h,function(l,k){return l&&k})}}}return g},traverseResult:function(g,h){var f=this,j=h||f.getResultManage(),i=null;if(!f.isBlankResult(h)){if(f.isMultipleResult(h)){i=[];c.each(j,function(k){i.push(g(k))})}else{i=g(j)}}return i},isMultipleResult:function(h){var f=this,i=h||f.getResultManage(),g=false;if(i.length>0&&c.isArray(i[0])){g=true}return g},destroy:function(){var f=this,h=f.getStore(),i=f.getResultManage(),g=f.get("container");f.fire("beforeDestroy");h.destroy();i.length=0;g[0].innerHTML="";f.detach();f=null},_init:function(){var f=this,g=c.one("#"+f.get("renderTo")),i=c.one("#"+f.get("resultId")),h=[];f._initStore();f.set("container",g);if(i){f.set("resultInput",i)}f.set("resultManage",h);f._initEvent()},_initEvent:function(){var f=this,g=f.getStore();g.on("searchTree",function(h){f.fire("searchTree",{text:h.text,pathList:h.pathList,valuePathList:h.valuePathList,result:h.result})});g.on("load",function(h){f.fire("load",{data:h.data,id:h.id,param:h.param})});f.on("load",function(h){f._loadTree();if(!f.get("isInit")){f.initData();f.set("isInit",true)}f.fire("loadFinished")});f.on("resultUpdate",function(h){f._updateResult()})},_loadTree:function(){var f=this;f.fire("loadTree")},_getStoreConfig:function(){var f=this,g=f.get("storeConfig");c.mix(g,{url:f._getStoreUrl(),idKey:f.get("idKey"),param:f.get("param"),data:f.get("data"),isJsonp:f.get("isJsonp"),autoLoad:false});return g},_initStore:function(){var f=this,g=f.get("store"),h;if(!g){h=f._getStoreConfig();g=new e(h)}f.set("store",g)},_getStoreUrl:function(){return this.get("url")},_pushResult:function(h){var g=this,j=g.getResultManage(),i={},f;i.id=h.id;i.value=h.value;i.isleaf=h.isleaf;j.push(i);g.fire("resultPush",{result:j,resultObj:i});g.fire("resultUpdate",{result:j})},_popResult:function(){var f=this,g=f.getResultManage(),h=g.pop();f.fire("resultPop",{result:g,resultObj:h});f.fire("resultUpdate",{result:g})},_updateResult:function(){var g=this,j=g.get("resultInput"),i=g.get("resultType").split(" "),f={},h=null;if(j){if(c.inArray("result",i)){h=g.getResultManage();if(h&&h.length>0){f.result=h}}if(c.inArray("id",i)){h=g.getIdFromResult();if(h!==null&&h!==""){f.id=h}}if(c.inArray("value",i)){h=g.getValueFromResult();if(h!==null&&h!==""){f.value=h}}if(c.inArray("path",i)){h=g.getPathFromResult();if(h&&h.length>0){f.path=h}}if(c.inArray("valuePath",i)){h=g.getValuePathFromResult();if(h&&h.length>0){f.valuePath=h}}if(c.inArray("valueStr",i)){h=g.getValueStrFromResult();if(h!==null&&h!==""){f.valueStr=h}}j.val(c.isEmptyObject(f)?"":c.JSON.stringify(f))}}});return b},{requires:["./store"]});KISSY.add("lpmodule/tree/list",function(h,m){var o=h.DOM,r=h.Event;var d="list-button-left",c="list-button-right",g="list-search-input",j="list-search-tip",k="list-i",n="list-more",f="list-selected",b="list-inner-inner",i="list-button-active",q="list-result-con",a="list-u",l=['<div class="list-container ks-clear">','<div class="list-left">','<s class="list-button list-button-left"></s>',"</div>",'<div class="list-inner">','<div class="list-inner-inner">',"</div>","</div>",'<div class="list-right">','<s class="list-button list-button-right"></s>',"</div>","</div>",'<div class="list-result tips tips-small tips-notice">',"<strong>\u60a8\u5f53\u524d\u7684\u9009\u62e9: </strong>",'<span class="list-result-con"></span>',"</div>"].join(""),p=['<div class="list-item">','<div class="list-search">','<input type="text" class="list-search-input"/>','<p class="list-search-tip"></p>',"</div>",'<ul class="list-u">',"</ul>","</div>"].join("");function e(t){var s=this;t=h.merge(e.config,t);e.superclass.constructor.call(s,t);s._initListTree()}e.config={searchTip:""};h.extend(e,m);h.augment(e,{_initListTree:function(){var t=this,u=t.get("container"),w,v,x,s;u[0].innerHTML=l;w=h.one("."+b,u);v=h.get("."+q,u);x=h.one("."+d,u);s=h.one("."+c,u);t.set("listsCon",w);t.set("resultCon",v);t.set("leftBtn",x);t.set("rightBtn",s);t.set("listWidth",215);t.set("containerWidth",860);t._initListTreeEvent()},_initListTreeEvent:function(){var t=this,u=t.get("container"),v=t.get("leftBtn"),s=t.get("rightBtn");t.on("resultUpdate",function(w){t._updateResultCon()});v.on("click",function(){if(o.hasClass(this,i)){t._roll("left")}});s.on("click",function(){if(o.hasClass(this,i)){t._roll("right")}});t.on("pushList popList",function(){t._resetListConWidth();t._rollManage(function(){if(t._isRoll()){t._roll("last")}})});t.on("beforeDestroy",function(){t._destroyListTree()})},_initListDom:function(w,u){var s=this,t=o.create(p),v=s.get("listsCon");v.append(t);w.itemsCon=h.one("."+a,t);w.searchInput=h.one("."+g,t);w.searchTip=h.one("."+j,t);w.searchInput.data("index",u);w.searchTip.text(s.get("searchTip"));return h.one(t)},_initListEvent:function(t){var s=this,u;t.searchTip.on("click",function(){h.one(this).hide().prev()[0].focus()});t.searchInput.on("focus",function(){h.one(this).next("."+j).hide()});t.searchInput.on("blur",function(){var v=h.one(this),w=v.next("."+j);if(!!v.val()){w.hide()}else{w.show()}});t.searchInput.on("keyup",function(w){if(w.which===32||w.which===8||w.which===46||(w.which>=65&&w.which<=90)||(w.which>=48&&w.which<=57)||(w.which>=96&&w.which<=105)){var v=h.one(this);if(u){u.cancel()}u=h.later(function(){s._searchList(v.val(),v.data("index"))},200)}});t.searchInput.on("keydown",function(v){if(v.which===13){return false}})},_initListItemsDom:function(w,t,v,s,z){var u=k,y=t.value,A,x;if(!t.isleaf){u+=(" "+n)}if(z){y=y.replace(z,"<s>"+z+"</s>")}A=['<li class="',u,'">',y,"</li>"].join("");x=o.create(A);w.itemsCon.append(x);x=h.one(x);return x},_initListItemsEvent:function(t){var s=this;t.on("click",function(){var u=h.one(this);if(!s._isItemSelect(u)){s._itemChangeSelect(h.one(this))}})},_getItems:function(s){return h.all("."+k,s.dom)},_isItemSelect:function(s){return s.hasClass(f)},_addItemSelect:function(s){s.addClass(f)},_removeItemSelect:function(s){s.removeClass(f)},_removeAllSelectByItem:function(s){s.siblings().removeClass(f)},_removeAllSelectByList:function(u){var s=this,t=s._getItems(u);t.removeClass(f)},_updateResultCon:function(){var s=this;s.get("resultCon").innerHTML=s.getValueStrFromResult()},_roll:function(u){var t=this,y=t.get("listsCon"),z=t.get("listWidth"),s=t.get("listConWidth"),x=t.get("containerWidth"),v=y.css("left").replace("px","")*1||0;var w=function(B,C){var A=v+B*C;A=A>0?0:x-s-A>0?x-s:A;t._rollAnim(A,function(){t._resetRollBtn()}).run()};if(u==="left"){w(1,z)}else{if(u==="right"){w(-1,z)}else{if(u==="last"){w(1,x-v-s)}else{if(u.target&&u.distance){w(u.target,u.distance)}}}}},_rollManage:function(t){var s=this,u=s.get("rollTimer");if(u){u.cancel()}u=h.later(t,200);s.set("rollTimer",u)},_rollAnim:function(u,t){var s=this;return h.Anim(s.get("listsCon"),{left:u+"px"},0.2,"easeOut",t)},_resetListConWidth:function(){var t=this,u=t.get("listsCon"),v=t.get("listWidth"),s=u.children().length*v;u.width(s+"px");t.set("listConWidth",s);return t},_resetRollBtn:function(){var u=this,x=u.get("listsCon"),t=u.get("listConWidth"),w=u.get("containerWidth"),v=x.css("left").replace("px","")*1||0,s=u.get("rightBtn"),y=u.get("leftBtn");if(t+v-w>0){s.addClass(i)}else{s.removeClass(i)}if(v<0){y.addClass(i)}else{y.removeClass(i)}},_isRoll:function(){var t=this,w=t.get("listsCon"),s=t.get("listConWidth"),v=t.get("containerWidth"),u=w.css("left").replace("px","")*1||0;t._resetRollBtn();if(v-u-s!==0){return true}return false},_destroyListTree:function(){var t=this,u=t.get("leftBtn"),s=t.get("rightBtn");u.detach().remove();s.detach().remove()}});return e},{requires:["./view"]});KISSY.add("lpmodule/tree/select",function(b,d){var c=b.DOM,a=b.Event;var f="<select></select>";function e(h){var g=this;h=b.merge(e.config,h);e.superclass.constructor.call(g,h);g._initSelecrtTree()}e.config={selectTpl:"<select></select>",selectCls:"form-field-select"};b.extend(e,d);b.augment(e,{_initSelecrtTree:function(){var g=this;g._initSelecrtTreeEvent()},_initSelecrtTreeEvent:function(){},_initList:function(m,k){var g=this,l={},j;if(m.length===0){return{}}j=g._initListDom(l,k);g._initListData(l,j,k);var i={id:null,value:"\u8bf7\u9009\u62e9..."},h=g._initListItemsDom(l,i);g._initListItemsData(h,i,k);g._initListItems(l,m,k);g._initListEvent(l);if(!l.selectedItem){g._getItems(l)[0].selected=true}return l},_initListDom:function(l,j){var h=this,k=null,g=null,i=h.get("container");k=new b.Node(h.get("selectTpl")).appendTo(i);g=h._getSelect(k);g.addClass(h.get("selectCls"));return k},_initListEvent:function(h){var g=this;g._getSelect(h.dom).on("change",function(){var i=this.options[this.selectedIndex];g._itemChangeSelect(b.one(i))})},_initListItemsDom:function(k,i){var g=this,j,h;j=['<option value="',i.id,'" title="',i.value,'">',i.value,"</option>"].join("");h=c.create(j);g._getSelect(k.dom).append(h);h=b.one(h);return h},_getItems:function(g){return b.all("option",g.dom)},_getSelect:function(g){g=b.one(g);if(g){if(g[0].tagName.toUpperCase()==="SELECT"){return g}else{return g.one("select")}}},_isItemSelect:function(g){return g[0].selected},_addItemSelect:function(g){g[0].selected=true},_removeItemSelect:function(g){g[0].selected=false},_removeAllSelectByItem:function(g){b.each(g.siblings(),function(h){g[0].selected=false})}});return e},{requires:["./view"]});KISSY.add("lpmodule/tree/selectcity",function(c,h){var e=c.DOM,a=c.Event;var f="http://lp.taobao.com/go/rgn/provincecitydata.php",g="http://lp.taobao.com/go/rgn/citydistrictdata.php",d="http://lp.taobao.com/go/rgn/provincecitydata-simple.php";function b(j){var i=this;j=c.merge(b.config,j);b.superclass.constructor.call(i,j)}b.config={resultType:"path",cityType:0};c.extend(b,h);c.augment(b,{_getStoreUrl:function(){var i=this,k=i.get("cityType"),j=i.get("url");if(!j){switch(k){case 0:j=f;break;case 1:j=g;break;case 2:j=d;break}i.set("url",j);i.set("isJsonp",true)}return j}});return b},{requires:["./select"]});KISSY.add("lpmodule/tree/standard",function(d,a,c){var e=d.DOM,b=d.Event;function f(h){var g=this;h=d.merge(f.config,h);f.superclass.constructor.call(g,h);g.events=["click","expand","collapse"];g._initTree()}f.config={title:"Tree",showRootNode:true,showAll:false,checkable:false,prefixCls:"lp-",contentTemplate:null,isGetAllSelectedChildren:false,isLazyLoad:false,lazyCount:5,lazyTime:300};d.extend(f,c);d.augment(f,{getTree:function(){return this.get("tree")},getChildrenByNode:function(g){if(g){return g.get("children")}else{return[]}},initTreeNode:function(j){var h=this,g=h.getTree(),i=h.get("showAll"),k=j===undefined?h.get("showRootNode"):j;if(i){g.expandAll()}else{if(k){h.nodeExpand(g)}}},addNodes:function(j,i){var g=this,h=null;if(j){i=i===undefined?g.get("isLazyLoad"):i;if(i){h=g._initLazyLoadProcess(g._addNodesLazyLoad)}g._addNodes(j,0,h)}return j},nodeExpand:function(i,h){var g=this;if(i){i.set("expanded",true);h=h===undefined?g.get("isLazyLoad"):h;g.fire("expand",{target:i,isLazyLoad:h})}},nodeCollapse:function(g){if(g){g.set("expanded",false)}},nodeSelect:function(i,j){var g=this,h=g.get("checkable"),j=j===undefined?true:j;if(!i){return}if(h){if(j){i.set("checkState",a.CheckNode.CHECK)}else{i.set("checkState",a.CheckNode.EMPTY)}}else{if(j){i.select();i.set("focused",true)}else{i.set("selected",false);i.set("focused",false)}}return g},isNodeSelected:function(j){var g=this,h=g.get("checkable"),i=false;if(!j){return}if(h){i=(j.get("checkState")===a.CheckNode.CHECK)}else{i=j.get("selected")}return i},showNodeById:function(l,i){var g=this,h=g.getStore(),k=[],j=[];if(l){if(d.isArray(l)){d.each(l,function(m){j=h.getPathById(m);if(j.length>0){k.push(h.getPathById(m))}})}else{k=h.getPathById(l)}}g.showNodeByPath(k,i);return g},showNodeByPath:function(i,h){var g=this,h=h===undefined?true:h;if(h){g.clearAllSelect()}if(i&&i.length>0){if(g.isMultipleResult(i)){d.each(i,function(j){g._showNodeByPath(j)})}else{g._showNodeByPath(i)}}return g},clearAllSelect:function(){var h=this,g=h.getTree();h.nodeSelect(g,false);g.collapseAll();h.initTreeNode();return h},getTreeResult:function(){var i=this,h=i.getTree(),g=[],j=[],k;k=function(r,n){n=n||0;var q=r.get("children");if(q){for(var p=0;p<q.length;p++){var m=g.length-n-1;for(var o=0;o<m;o++){g.pop()}g[n]={};g[n].id=q[p].get("nodeId");g[n].value=q[p].get("content");g[n].isleaf=q[p].get("isLeaf");if(!i.get("isGetAllSelectedChildren")){if(i.isNodeSelected(q[p])){j.push(d.clone(g))}else{if(!q[p].get("isLeaf")){k(q[p],n+1)}}}else{if(q[p].get("isLeaf")){if(i.isNodeSelected(q[p])){j.push(d.clone(g))}}else{k(q[p],n+1)}}}}return false};k(h);i.set("resultManage",j);i.fire("resultUpdate",{result:j});return j},getNodeChildrenData:function(i){var g=this,j=i.get("nodeId")||null,h=g._getNodesData(j,i);return h},_initTree:function(){var g=this;g.set("lazyLoadManage",{});g._newTree();g._initTreeEvent();g.storeLoad()},_initTreeEvent:function(){var h=this,g=h.getTree();h.on("loadTree",function(i){});h.on("initData",function(i){h.initTreeNode(true);h._checkNodeLoaded(h.getTree(),h.showNodeById,[i.id])});g.on("expand",function(i){h.nodeExpand(i.target)});h.on("expand",function(j){var i=j.target;if(!i.get("children").length){h.addNodes(i,j.isLazyLoad)}});g.on("collapse",function(i){h.fire("collapse",{target:i.target})});g.on("click",function(i){h.fire("click",{target:i.target})});h.on("beforeReload",function(){h._destroyTreeChildren()});h.on("beforeDestroy",function(){h._destroyTree()})},_newTree:function(){var h=this,i=h.get("checkable"),j={content:h.get("title"),prefixCls:h.get("prefixCls"),isLeaf:false,tooltip:h.get("title"),render:"#"+h.get("renderTo")},g=null;if(!i){g=new a(j)}else{g=new a.CheckTree(j)}g.render();h.set("tree",g)},_newNode:function(g,k,m,n,o){var l=this,h=l.get("checkable"),p=l.getTree(),j={content:k,nodeId:g,prefixCls:l.get("prefixCls"),isLeaf:n,tooltip:m,tree:p},i=null;if(!h){i=new a.Node(j)}else{j=d.merge(j,{checkState:o===a.CheckNode.CHECK?a.CheckNode.CHECK:a.CheckNode.EMPTY});i=new a.CheckNode(j)}return i},_addNodes:function(h,m,k){var o=this,j=o.getStore().get("adapterForNode"),p=o.getNodeChildrenData(h),s=h.get("checkState");m=m===undefined?0:m;for(var l=m;l<p.length;l++){var g=p[l][j.id],n=o._getContent(p[l]),q=p[l][j.value],r=p[l][j.isleaf];h.addChild(o._newNode(g,n,q,r,s));if(!!k){if(l<p.length-1){if(!o._lazyLoad(h,l,k)){return false}}else{o._destroyLazyLoadProcess(k)}}}},_addNodesLazyLoad:function(i){var g=this,k=g.get("lazyTime"),h=g.get("lazyLoadManage"),j=h[i];setTimeout(function(){g._addNodes(j.node,j.index,i)},k)},_initLazyLoadProcess:function(j){var g=this,h=g.get("lazyLoadManage"),i=d.guid(),k={func:j,node:null,count:0,index:0};h[i]=k;return i},_destroyLazyLoadProcess:function(i){var g=this,h=g.get("lazyLoadManage");delete h[i];g.fire("destroyLazyLoadProcess",{id:i})},_lazyLoad:function(l,h,j){var g=this,k=g.get("lazyCount"),i=g.get("lazyLoadManage"),m=i[j];m.count++;if(!(m.count<k)){m.index=h+1;m.node=l;m.count=0;m.func.call(g,j);return false}return true},_checkNodeLoaded:function(l,k,h){var g=this,i=g.getNodeChildrenData(l),j=g.get("isLazyLoad"),m,n=function(){var o=g.getChildrenByNode(l);if(!(o.length<i.length)){clearInterval(m);return k.apply(g,h)}};h.push(l);if(!j){return k.apply(g,h)}else{m=setInterval(n,100)}},_getContent:function(k){var g=this,j=g.get("contentTemplate"),h,i;if(j){i=d.Template(j).render(k)}else{h=g.getStore().get("adapterForNode");i=k[h.value]}return i},_getNodesData:function(l,k){var g=this,i=g.getStore(),h=[],j;if(l){j=i.getNodeById(l);if(i.isTreeReady(j,function(){g.addNodes(k)})){h=i.getChildrenByNode(j)}}else{h=i.getTreeData()}return h},_showNodeByPath:function(j){var h=this,g=h.getTree(),i=h.getChildrenByNode(g);return h._getNodeByPath(i,j,0)},_getNodeByPath:function(i,k,h){var g=this,l=k[h],j=null;d.each(i,function(m){if(m.get("nodeId")===l){j=m;return false}});if(j){if(h<k.length-1){g.nodeExpand(j);return g._checkNodeLoaded(j,g._getNextNodeByPath,[k,h+1])}else{g.nodeSelect(j)}}return j},_getNextNodeByPath:function(j,h,i){var g=this;nodeList=g.getChildrenByNode(i);return g._getNodeByPath(nodeList,j,h)},_destroyTree:function(){var h=this,g=h.getTree();g.destroy()},_destroyTreeChildren:function(){var h=this,g=h.getTree();g.removeChildren(true)}});return f},{requires:["tree","./base","template"]});KISSY.add("lpmodule/tree/store",function(b){var c=b.DOM,a=b.Event;function d(f){var e=this;f=b.merge(d.config,f);d.superclass.constructor.call(e,f);e.events=["load","searchTree"];e._init()}d.config={url:null,idKey:null,param:{},data:[],isJsonp:false,autoLoad:true,adapterForNode:{id:"id",value:"value",children:"children",parent:"parent",isleaf:"isleaf"},adapterForData:{success:"success",nodes:"nodes",message:"message"},dataErrorFunc:function(e){b.error(e)}};b.extend(d,b.Base);b.augment(d,{isTreeReady:function(i,h){var e=this,f=e.get("adapterForNode"),g,j=true;if(i){if(i[f.isleaf]){return true}else{g=i[f.children]}}else{g=e.getTreeData()}if(g.length===0){j=false}if(!j){var k=i?i[f.id]:null;e.load(k,null,h)}return j},load:function(g,f,h,j){var k=this,i=k.get("adapterForData"),l=k.get("idKey"),j=j||false,e=k._getParam(g),m={type:"post",dataType:"json"};f=f||k.get("url");if(!f){throw"please assign the URL of Data for Tree!"}if(k.get("isJsonp")){m=b.merge(m,{type:"get",dataType:"jsonp",cache:false,crossDomain:true})}b.io(b.merge(m,{url:f,data:e,success:function(n){if(n[i.success]===true||n[i.success]==="true"){k.fire("load",{data:n[i.nodes],id:j?null:e[l]||null,param:e});if(h){h()}}else{k._dataError(n[i.message])}},error:function(){k._dataError("\u8bf7\u6c42\u5f02\u5e38\uff01")}}))},initLoad:function(){var e=this;if(e.get("url")){e.load()}else{e.setTreeData(e.get("data"))}},traverseTreeById:function(l){var e=this,f=e.get("adapterForNode"),k=e.getTreeData(),j=[],g=[],i=[],h;h=function(n,m){m=m||0;if(n){for(var o=0;o<n.length;o++){if(n[o][f.id]===l||(!n[o][f.isleaf]&&h(n[o][f.children],m+1))){j[m]=n[o][f.id];g[m]=n[o][f.value];i[m]=n[o];return true}}}return false};if(l){h(k)}return{path:j,valuePath:g,pathNode:i,node:i[i.length-1]||null}},traverseTreeByText:function(l){var k=this,e=k.get("adapterForNode"),m=k.getTreeData(),o=[],i=[],j=[],n=[],f=[],g=[],h;h=function(s,q){q=q||0;if(s){for(var t=0;t<s.length;t++){var p=o.length-q-1;for(var r=0;r<p;r++){o.pop();j.pop();i.pop()}o[q]=s[t][e.id];j[q]=s[t][e.value];i[q]=s[t];if(s[t][e.value].indexOf(l)>-1){n.push(b.clone(o));g.push(b.clone(j));f.push(k.dataFilter(i))}if(!s[t][e.isleaf]){h(s[t][e.children],q+1)}}}};if(l){h(m)}return{pathList:n,pathNodeList:f,valuePathList:g}},getNodeById:function(f){var e=this;return e.traverseTreeById(f).node},getNodeByPath:function(j){j=j||[];var e=this,f=e.get("adapterForNode"),i=e.getTreeData(),h=null,g=i;b.each(j,function(k){b.each(g,function(l){if(l[f.id]===k){h=l;return false}});g=h[f.children]});return h},getPathById:function(f){var e=this;return e.traverseTreeById(f).path},getParentById:function(i){var e=this,f=e.get("adapterForNode"),g=e.getNodeById(i),h=g[f.parent];return e.getNodeById(parent)},getChildrenById:function(h){var e=this,f=e.get("adapterForNode"),g=e.getNodeById(h);return g?g[f.children]||[]:[]},getChildrenByPath:function(h){h=h||[];var e=this,f=e.get("adapterForNode"),g=null;if(h.length===0){return e.getTreeData()}else{g=e.getNodeByPath(h);return g?g[f.children]||[]:[]}},getChildrenByNode:function(h){var e=this,f=e.get("adapterForNode"),g=[];if(h){g=h[f.children]||[]}else{g=[]}return g},getTreeData:function(){var e=this;return e.get("treeData")},setTreeData:function(f,g){var e=this;e.fire("load",{data:f,id:g})},searchTree:function(g){var f=this,e=f.traverseTreeByText(g);f.fire("searchTree",{text:g,pathList:e.pathList,valuePathList:e.valuePathList,result:e});return e},dataFilter:function(h){var e=this,f=e.get("adapterForNode"),g=[];b.each(h,function(j){var i=b.clone(j,function(m,l){if(l===f.children){return false}});g.push(i)});return g},getTreeByLevel:function(j){var e=this,i=e.getTreeData(),f=e.get("adapterForNode"),g=b.clone(i),h;h=function(l,k){k=k||0;if(l){for(var m=0;m<l.length;m++){if(k===j-1){l[m][f.children]=[];l[m][f.isleaf]=true}else{h(l[m][f.children],k+1)}}}};if(j>0){h(g)}else{g=[]}return g},destroy:function(){var e=this;e.detach();e=null},_init:function(){var e=this;e.set("treeData",[]);e._initIdKey();e._initEvent();if(e.get("autoLoad")){e.initLoad()}},_initEvent:function(){var e=this;e.on("load",function(f){e._fillInTreeData(f.data,f.id)})},_initIdKey:function(){var f=this,g=f.get("adapterForNode"),e=f.get("idKey");if(!e){f.set("idKey",g.id)}},_fillInTreeData:function(i,j){var e=this,f=e.get("adapterForNode"),g=e.getTreeData(),h;if(j){h=e.getNodeById(j);if(h){g=h[f.children]}}g.length=0;b.each(i,function(k){g.push(k)})},_dataError:function(f){var e=this;if(f){e.get("dataErrorFunc")(f)}},_getParam:function(i){var f=this,e=f.get("idKey"),g=f.get("lastParam")||f.get("param"),h={};if(!i||b.isEmptyObject(i)){h=g}else{if(b.isNumber(i)||b.isString(i)){h[e]=i;h=b.merge(g,h)}else{if(b.isPlainObject(i)){h=i}}}f.set("lastParam",h);return h}});return d},{requires:[]});KISSY.add("lpmodule/tree/suggestselect",function(e,q){var d=window,t=e.DOM,u=e.Event,v=document,j=e.one("body");var i="list-li",h="LI",l="li",n="<div>",g="ol",r="hidden",w="undefined",x="",c="select-field",b="ks-selected",o="suggest-hover",m="suggest-key",a="suggest-selected",f="suggest-select-input",p='<div class="suggest-select"><input class="suggest-select-input" /><s class="suggest-select-icon"></s></div>',k=['<div class="suggest-container">','<div class="suggest-content">','<ol class="ks-clear">',"</ol>","</div>","</div>"].join("");function s(z){var y=this;z=e.merge(s.config,z);s.superclass.constructor.call(y,z);y._initSuggestSelect()}s.config={offset:-1,containerWidth:"auto"};e.extend(s,q);e.augment(s,{_initSuggestSelect:function(){var y=this;y._initSuggestSelectEvent()},_initSuggestSelectEvent:function(){var y=this;y.on("changeSelectByStore",function(C){var A=C.list.input,z=C.list.itemsCon,B=C.item;if(B){t.val(A,B.data("nodeData").value);y.hide(z)}})},_initListDom:function(D,C){var E=this,F=t.create(p),B=e.Node(t.create('<div class="'+c+'"></div>')),z=E.get("container");B.append(F);z.append(B);D.itemsSel=e.one(F);D.input=e.one("."+f,F);D.input.data("index",C);var y="min-width:"+D.input.width()+"px;",G="*max-width:"+D.input.width()+"px;",A=t.create(k,{style:"position:absolute;visibility:hidden;z-index:9999;"+G+y});D.itemsCon=A;D.itemsOl=t.get(g,A);B.append(A);E._setContainerRegion(D);return e.one(B)},_initListEvent:function(C){var z=this,y=C.itemsSel,B=C.input,A=C.itemsCon,D;u.on(y,"click",function(E){z.show(C);E.halt()});u.on(v,"click",function(E){z.hide(A)});C.input.on("keyup",function(F){if(F.which===32||F.which===8||F.which===46||(F.which>=65&&F.which<=90)||(F.which>=48&&F.which<=57)||(F.which>=96&&F.which<=105)){var E=e.one(this);if(D){D.cancel()}D=e.later(function(){z._searchList(E.val(),E.data("index"))},200)}});C.input.on("keydown",function(E){if(E.which===13){return false}})},_initListItemsDom:function(C,z,B,y,G){var A=i,F=z.value,E=F,H,D;if(G){F=F.replace(G,"<s>"+G+"</s>")}H=['<li class="',A,'" title="',E,'">',F,"</li>"].join("");D=t.create(H);e.Node(C.itemsOl).append(D);D=e.one(D);return D},_initListItemsEvent:function(z,A){var y=this;z.on("click",function(C){var B=e.one(this);if(!y._isItemSelect(B)){y._itemChangeSelect(e.one(this))}else{if(B.data("nodeData").value!==A.input.value){y._itemChangeSelect(e.one(this))}}});z.on("mouseenter",function(B){var C=B.target;y._setHoverItem(C)});z.on("mouseleave",function(B){var C=B.target;y._removeHoverItem()})},_removeHoverItem:function(){if(this.selectedItem.nodeName!==h){this.selectedItem=t.parent(this.selectedItem,l)}t.removeClass(this.selectedItem,o);this.selectedItem=undefined},_setHoverItem:function(y){t.addClass(y,o);this.selectedItem=y},hide:function(y){if(!this.isVisible(y)){return}this.invisible(y)},show:function(A){var y=this;if(y.isVisible(A.itemsCon)){return}var z=t.get(A.itemsCon);y._setContainerRegion(A);y.visible(A.itemsCon)},isVisible:function(y){return y.style.visibility!=r},invisible:function(y){t.style(y,"visibility",r)},visible:function(y){t.style(y,"visibility",x)},_getItems:function(y){return e.all("."+i,y.dom)},_isItemSelect:function(y){return y.hasClass(a)},_addItemSelect:function(y){y.addClass(a)},_removeItemSelect:function(y){y.removeClass(a)},_removeAllSelectByItem:function(y){y.siblings().removeClass(a)},_removeAllSelectByList:function(A){var y=this,z=y._getItems(A);z.removeClass(a)},_setContainerRegion:function(B){var y=this,A=B.itemsSel,C=t.offset(A),z=t.get(B.itemsCon);t.offset(z,{left:C.left,top:C.top+A.offsetHeight+y.get("offset")});t.width(z,y.get("containerWidth")||A.offsetWidth-2)}});return s},{requires:["./view"]});KISSY.add("lpmodule/tree",function(c,e,d,b,g,a,f){e.Store=d;e.List=b;e.Select=g;e.SelectCity=a;e.SuggestSelect=f;c.namespace("LP");c.LP.Tree=e},{requires:["lpmodule/tree/standard","lpmodule/tree/store","lpmodule/tree/list","lpmodule/tree/select","lpmodule/tree/selectcity","lpmodule/tree/suggestselect","lpmodule/css/module.css"]});KISSY.add("lpmodule/tree/view",function(d,c,b){var e=d.DOM,a=d.Event;function f(h){var g=this;h=d.merge(f.config,h);if(!h.renderTo||!e.get("#"+h.renderTo)){throw"please assign the id of render Dom!"}f.superclass.constructor.call(g,h);g.events=["pushList","popList","itemChangeSelect","changeSelectByClick","changeSelectByStore","pathUpdate"];g._initView()}d.extend(f,c);d.augment(f,{getListManager:function(){return this.get("listManager")},updateListsByPath:function(i){var g=this,h=g.getStore();if(i){h.getViewsByPath(i)}},updateListsById:function(i){var g=this,h=g.getStore();i=i||null;h.getViewsById(i)},_initStore:function(){var g=this,h=g.get("store"),i;if(!h){i=g._getStoreConfig();h=new b(i)}g.set("store",h)},_initView:function(){var g=this;g._initListManager();g._initViewEvent();g.storeLoad()},_initViewEvent:function(){var g=this,h=g.getStore();g.on("loadTree",function(i){});g.on("initData",function(i){h.getViewsByPath();g.updateListsById(i.id)});h.on("popView",function(){g._popList()});h.on("pushView",function(i){g._pushList(i.view.list)});h.on("changeSelect",function(i){g._changeSelectByStore(i.id)});h.on("searchView",function(i){g._updataListForSearch(i.data,i.index,i.text)});g.on("itemChangeSelect",function(i){g._changeSelectByClick(i.item,i.index)});g.on("changeSelectByClick",function(i){g._getSelectedPath(i.index)});g.on("pathUpdate",function(i){g.updateListsByPath(i.path)});g.on("changeSelectByStore",function(j){var i=this;if(j.item){i._pushResult(j.item.data("nodeData"))}else{i._popResult()}});g.on("beforeReload",function(){g._destroyView()});g.on("beforeDestroy",function(){g._destroyView()})},_initListManager:function(){var g=this,h={listPath:[],lists:[]};g.set("listManager",h)},_pushList:function(j){var g=this,i=g.getListManager(),h=g._initList(j,i.lists.length);i.lists.push(h);g.fire("pushList",{list:h});return h},_popList:function(){var g=this,i=g.getListManager(),h=i.lists.pop();g._destroyList(h);g.fire("popList",{list:h});return h},_itemChangeSelect:function(i){var g=this,h=i.data("nodeData")||{};g.fire("itemChangeSelect",{item:i,data:h,index:h.index})},_getSelectedPath:function(h){var g=this,i=g.getListManager(),j=[];if(h===null||h===undefined){h=i.lists.length-1}d.each(i.lists,function(l,k){if(k>h){return false}if(l.selectedId){j.push(l.selectedId)}});i.listPath=j;g.fire("pathUpdate",{path:j})},_searchList:function(j,i){var g=this,h=g.getStore();h.searchView(j,i)},_updataListForSearch:function(l,i,m){var g=this,j=g.getListManager(),k=j.lists[i],h=k.selectedId;g._destroyListItems(k);g._initListItems(k,l,i,h,m)},_changeSelectByClick:function(j,h){var g=this,i=g.getListManager(),k=i.lists[h];if(!g._isItemSelect(j)){g._removeAllSelectByItem(j);g._addItemSelect(j)}g._setListSelected(k,j,j.data("nodeData").id);g.fire("changeSelectByClick",{list:k,item:j,index:h})},_changeSelectByStore:function(m){var g=this,j=g.getListManager(),l=j.lists[j.lists.length-1],i=g._getItems(l),k=l.selectedItem,h=l.selectedId;if(!(m&&h&&h===m)){if(k){g._removeItemSelect(k)}if(m){d.each(i,function(n){n=d.one(n);if(n.data("nodeData").id===m){k=n;h=m;return false}});g._addItemSelect(k)}else{k=null;h=null}g._setListSelected(l,k,h)}g.fire("changeSelectByStore",{list:l,item:k});return k},_setListSelected:function(h,g,i){h.selectedItem=g;h.selectedId=i},_isItemSelect:function(g){},_addItemSelect:function(g){},_removeItemSelect:function(g){},_removeAllSelectByItem:function(g){},_removeAllSelectByList:function(g){},_initList:function(k,i){var g=this,j={},h;if(k.length===0){return{}}h=g._initListDom(j,i);g._initListData(j,h,i);g._initListItems(j,k,i);g._initListEvent(j);return j},_initListData:function(j,h,i){var g=this;j.dom=h;j.index=i;g._setListSelected(j,null,null)},_initListDom:function(h,g){},_initListEvent:function(g){},_initListItems:function(k,j,i,m,l){var g=this,h=g.getStore().get("adapterForNode");d.each(j,function(p){var o,n={id:p[h.id],parent:p[h.parent],value:p[h.value],isleaf:p[h.isleaf]};o=g._initListItemsDom(k,n,i,m,l);if(m&&m===n.id){g._addItemSelect(o);g._setListSelected(k,o,m)}g._initListItemsEvent(o,k);g._initListItemsData(o,n,i)})},_initListItemsData:function(i,h,g){h.index=g;i.data("nodeData",h)},_initListItemsDom:function(i,h,g,k,j){},_initListItemsEvent:function(g,h){},_getItems:function(g){},_destroyList:function(i){var g=this,h;if(!d.isEmptyObject(i)){g._destroyListItems(i);i.dom.detach().remove();i={}}},_destroyListItems:function(i){var g=this,h=g._getItems(i);h.detach().remove()},_destroyView:function(){var g=this,i=g.getListManager(),h=g.getStore();d.each(i.lists,function(j){g._destroyList(j)});i.listPath=[];i.lists=[];h._destroyView()}});return f},{requires:["./base","./viewstore"]});KISSY.add("lpmodule/tree/viewstore",function(c,e){var d=c.DOM,a=c.Event;function b(g){var f=this;g=c.merge(b.config,g);b.superclass.constructor.call(f,g);f.events=["pushPath","popPath","pushView","popView","searchView","changeSelect"];f._initView()}c.extend(b,e);c.augment(b,{getViewManager:function(){return this.get("viewManager")},getViewsByPath:function(p){p=p||[];var o=this,m=o.getViewManager(),n=m.viewPath.length,g=o.get("adapterForNode"),h=0,f=o.getNodeByPath(p);if(!o.isTreeReady(f,function(){o.getViewsByPath(p)})){return false}if(p.length===0){o._setBaseView()}c.each(p,function(k,j){if(k!==m.viewPath[j]){h=j;return false}});for(var l=0;l<(n-h);l++){o._popViewPath()}for(var i=h;i<p.length;i++){o._pushViewPath(p[i])}return m},getViewsById:function(h){var f=this,g=f.getPathById(h);return f.getViewsByPath(g)},getViewIndex:function(g){var f=this,i=f.getViewManager(),h=null;c.each(i.views,function(j,k){if(j===g){h=k;return false}});return h},searchView:function(l,j){var f=this,h=f.get("adapterForNode"),i=f.getViewManager(),g=i.views[j],k;l=l||"";k=c.filter(g.list,function(m){return m[h.value].indexOf(l)>-1});f.fire("searchView",{data:k,index:j,text:l});return k},_initView:function(){var f=this;f._initViewManage();f._initViewEvent()},_initViewEvent:function(){var f=this;f.on("pushPath",function(g){f._pushView(g.id,g.path)});f.on("popPath",function(g){f._popView()})},_initViewManage:function(){var f=this,g={viewPath:[],views:[]};f.set("viewManager",g)},_getViewByPath:function(h){h=h||[];var f=this,g={};g.list=f._getDataOfView(h);g.selectedId=null;return g},_setBaseView:function(){var f=this,h=f.getViewManager(),g;if(h.views.length===0){g=f._getViewByPath();h.views.push(g);f.fire("pushView",{view:g})}},_getDataOfView:function(j){j=j||[];var f=this,g=f.get("adapterForNode"),i=f.getChildrenByPath(j),h=f.dataFilter(i);return h},_pushViewPath:function(h){var f=this,g=f.getViewManager();g.viewPath.push(h);f.fire("pushPath",{id:h,path:g.viewPath});return g.viewPath},_popViewPath:function(){var f=this,g=f.getViewManager(),h;if(g.viewPath.length===0){return}h=g.viewPath.pop();f.fire("popPath",{id:h,path:g.viewPath});return g.viewPath},_pushView:function(l,j){var f=this,i=f.getViewManager(),k=f._getViewByPath(j),h,g;f._setBaseView();g=i.views[i.views.length-1];f._changeViewSelect(g,l);i.views.push(k);f.fire("pushView",{view:k});return k},_popView:function(){var f=this,h=f.getViewManager(),i,g;i=h.views.pop();f.fire("popView",{view:i});g=h.views[h.views.length-1];f._changeViewSelect(g,null);return i},_changeViewSelect:function(g,h){var f=this;g.selectedId=h;f.fire("changeSelect",{view:g,id:h})},_destroyView:function(){var f=this,g=f.getViewManager();g.viewPath=[];g.views=[]}});return b},{requires:["./store"]});
