KISSY.add("lpmodule/select/multiple",function(b){var i=b.DOM,h=b.Event;var c="lp-select-item-checkbox",d="lp-select-item",f="lp-select-item-selected",g="lp-select-multiple",a="lp-select-item-disabled";function e(){}e.config={itemTemplate:'<li class="lp-select-item{{#if disabled}} lp-select-item-disabled{{/if}}" title="{{text}}"><input type="checkbox" value="{{value}}" class="lp-select-item-checkbox" {{#if disabled}}disabled="disabled"{{/if}}/> {{text}}</li>'};b.augment(e,{itemClick:function(k){var j=this;if(!k.hasClass(a)){if(k.hasClass(f)){j.removeSelect(k)}else{j.addSelect(k)}}},_setCheckboxStatus:function(m){var k=this,j=b.get("."+c,m),l=m.hasClass(f);j.checked=l}});b.mix(e,{init:function(){},initEvent:function(){var j=this;j.on("addSelect removeSelect",function(k){j._setCheckboxStatus(k.dom)});j.on("clearSelect",function(k){k.dom.each(function(l){j._setCheckboxStatus(b.one(l))})});j.on("itemCreated",function(l){var k=b.one("."+c,l.dom);k.on("mouseup",function(m){m.halt();this.checked=!b.one(this).parent("."+d).hasClass(f)})});j.on("selectCreated",function(l){var k=j.get("items");k.addClass(g)})}});return e},{requires:[]});KISSY.add("lpmodule/select/search",function(b){var i=b.DOM,h=b.Event;var d="lp-select-item",g="lp-select-item-selected",f="lp-select-search-input",c=['<input type="text" class="control-text ',f,'"/>'].join(""),e=['<li class="',d,'"></li>'].join("");function a(){}a.config={};b.augment(a,{_getItemInner:function(n){var j=this,m=j.get("itemTemplate"),o=j.get("searchText")||"",l=n.text,k=l;if(!!o){k=l.replace(o,"<s>"+o+"</s>")}if(m){k=b.Template(m).render({text:l,value:n.value})}return k},_getInnerHeight:function(){var k=this,j=k.get("itemsCon"),l=j.outerHeight(true)+24;return l},getDataByText:function(m){var j=this,l=j.getData(),k=[];if(!!m){b.each(l,function(n){if(n.text.indexOf(m)>-1){k.push(n)}})}else{k=l}return k},_search:function(m){var j=this,m=m===undefined?"":m,l=j.get("searchText")||"",k;if(m!==l){k=j.getDataByText(m);j._destroyItems();j.set("searchText",m);j.createItems(k);j.open();j._initData(false);j.get("searchInput").val(m)}},_initSearchInput:function(){var j=this,l=b.one(i.create(c)),k=j.get("items");k.prepend(l);j.set("searchInput",l);j._initSearchInputEvent()},_initSearchInputEvent:function(){var j=this,k=j.get("searchInput"),l;k.on("click",function(m){m.halt()});k.on("keyup",function(n){if(n.which===32||n.which===8||n.which===46||(n.which>=65&&n.which<=90)||(n.which>=48&&n.which<=57)||(n.which>=96&&n.which<=105)){var m=b.one(this);if(l){l.cancel()}l=b.later(function(){j.fire("search",{text:b.trim(m.val())})},200)}});k.on("keydown",function(m){if(m.which===13){return false}})}});b.mix(a,{init:function(){},initEvent:function(){var j=this;j.on("selectCreated",function(){j._initSearchInput()});j.on("search",function(k){j._search(k.text)});j.on("changeSelect",function(k){if(k.action==="remove"){j._search()}})}});return a},{requires:[]});KISSY.add("lpmodule/select",function(f,n,d){var p=f.DOM,o=f.Event;var l="lp-select-handle",j="lp-select-input",i="lp-select-icon",b="lp-select-items",k="lp-select-items-con",h="lp-select-item",c="lp-select-item-hover",m="lp-select-item-selected",e="lp-select-item-disabled",g=['<div class="lp-select">','<div class="',l,'">','<input type="text" class="control-text ',j,'" readonly="readonly"/>','<s class="',i,'"></s>',"</div>",'<div class="',b,'">','<ul class="',k,'">',"</ul>","</div>","</div>"].join("");function a(r){var q=this;r=f.merge(a.config,r);q._initPlugins(r);if(!r.renderTo||!p.get("#"+r.renderTo)){throw"please assign the id of render Dom!"}a.superclass.constructor.call(q,r);q.events=["load","selectCreated","itemCreated","itemsCreated","itemClick","addSelect","removeSelect","clearSelect","changeSelect","resultUpdate"];q._init()}a.config={renderTo:null,resultId:null,data:null,url:null,params:null,itemTemplate:'<li class="lp-select-item{{#if disabled}} lp-select-item-disabled{{/if}}" title="{{text}}">{{text}}</li>',checkable:false,searchable:false,fitWidth:false,width:148,height:200};f.extend(a,f.Base);f.augment(a,{createSelect:function(){var r=this,s=r.get("container"),q=f.one(p.create(g)),u=f.one("."+l,q),v=f.one("."+b,q),w=f.one("."+k,q),t=f.one("."+j,q);s.append(q);r.set("handle",u);r.set("items",v);r.set("itemsCon",w);r.set("input",t);r.fire("selectCreated",{dom:q});return q},createItems:function(r){var q=this,r=r||q.getData();if(!r||r.length===0){return false}f.each(r,function(s){q.createItem(s)});q.fire("itemsCreated")},createItem:function(s){var q=this,t=q.get("itemsCon"),r=f.one(p.create(q._getItemDom(s)));r.data("data",s);t.append(r);q.fire("itemCreated",{dom:r});return r},reload:function(s){var q=this,r=q.get("store");if(f.isArray(s)){r.setResult(s)}else{r.load(s)}},getData:function(){var q=this,r=q.get("store");return r.getResult()},getDataByItem:function(r){var q=this;return r.data("data")},getValueStrFromResult:function(){var q=this,s=q.getResultManage(),r=[];f.each(s,function(t){r.push(t.value)});return r.join(",")},getTextStrFromResult:function(){var q=this,r=q.getResultManage(),s=[];f.each(r,function(t){s.push(t.text)});return s.join(",")},getResultManage:function(){var q=this,r=q.get("resultManage");return r||[]},itemClick:function(r){var q=this;if(!r.hasClass(e)){if(r.hasClass(m)){q.removeSelect(r)}else{q.clearSelect(false);q.addSelect(r)}q.close()}},addSelect:function(r,s){var q=this,s=s===undefined?true:s;if(q.fire("beforeAddSelect",{dom:r,data:q.getDataByItem(r)})===false){return null}r.addClass(m);q.fire("addSelect",{dom:r,data:q.getDataByItem(r)});if(s){q.fire("changeSelect",{action:"add"})}},removeSelect:function(r,s){var q=this,s=s===undefined?true:s;if(q.fire("beforeRemoveSelect",{dom:r,data:q.getDataByItem(r)})===false){return null}r.removeClass(m);q.fire("removeSelect",{dom:r,data:q.getDataByItem(r)});if(s){q.fire("changeSelect",{action:"remove"})}},clearSelect:function(s){var r=this,s=s===undefined?true:s,q=r._getItemList();if(r.fire("beforeClearSelect")===false){return null}q.removeClass(m);r.fire("clearSelect",{dom:q});if(s){r.fire("changeSelect",{action:"clear"})}},open:function(){this.get("items").show()},close:function(){this.get("items").hide()},toggle:function(){this.get("items").toggle()},clear:function(){var r=this,q=r._getItemList();if(q.length>0){r.clearSelect();r._destroyItems()}},changeSelect:function(s,t){var r=this,q=r._getItemList(),t=t===undefined?true:t;if(f.isArray(s)&&s.length>0){r.clearSelect(false);f.each(s,function(u){q.each(function(w){var v=r.getDataByItem(w);if(v.value===u.value){r.addSelect(w,false)}})});if(t){r.fire("changeSelect",{action:"init"})}}},destroy:function(){var q=this,r=q.get("container"),t=q.get("handle"),s=q.get("items");q._destroyItems();t.detach().remove();s.detach().remove();o.detach("body","click",q._bodyClickEvent,q);o.detach("body","closeAnother",q._bodyClickEvent,q);r.html("");q.detach();q=null},_init:function(){var q=this,r=f.one("#"+q.get("renderTo")),s=null,t=[];q.set("container",r);q.set("resultManage",t);q.set("isLoaded",false);if(q.get("resultId")){s=f.one("#"+q.get("resultId"));q.set("resultCon",s)}q._initEvent();q.createSelect();q._initStore()},_initEvent:function(){var q=this;q.on("load",function(){q.clear();q.createItems();q._initData()});q.on("selectCreated",function(){q._initSelectEvent()});q.on("itemCreated",function(r){q._initItemEvent(r.dom)});q.on("itemsCreated",function(){q._setDomStyle()});q.on("itemClick",function(r){q.itemClick(r.dom)});q.on("changeSelect",function(){q._resetResult()});q.on("resultUpdate",function(){q._updateResult()});q._initPluginsEvent()},_initStore:function(){var q=this,t=q.get("data")||[],s=q.get("url"),u,r=new f.LP.Store({url:s});r.on("load",function(){q.set("isLoaded",true);q.fire("load")});q.set("store",r);if(t.length>0||!s){r.setResult(t)}else{u=q.get("params");r.load(u)}},_initSelectEvent:function(){var q=this,r=q.get("handle");r.on("click",function(s){s.halt();q.toggle();f.one("body").fire("closeAnother",{selectObj:q})});o.on("body","click",q._bodyClickEvent,q);o.on("body","closeAnother",q._bodyClickEvent,q)},_initItemEvent:function(r){var q=this;r.on("mouseenter",function(){f.one(this).addClass(c)});r.on("mouseleave",function(){f.one(this).removeClass(c)});r.on("click",function(s){s.halt();q.fire("itemClick",{dom:f.one(this)})})},_bodyClickEvent:function(r){var q=this;if(!r.selectObj||r.selectObj!==q){q.close()}},_initData:function(t){var r=this,s=r.get("resultCon"),q=[],t=t===undefined?true:t;if(s&&!!s.val()){q=f.JSON.parse(s.val());r.changeSelect(q,t)}},_resetResult:function(){var r=this,t=r.getResultManage(),s=r.get("items"),q=f.all("."+m,s);t.length=0;q.each(function(u){t.push(r.getDataByItem(u))});r.fire("resultUpdate",{result:t});return t},_updateResult:function(){var q=this,u=q.getResultManage(),t=q.get("resultCon"),s=q.get("input"),r=q.getTextStrFromResult();if(t){t.val(u.length===0?"":f.JSON.stringify(u))}s.val(r).attr("title",r)},_getItemDom:function(t){var q=this,s=q.get("itemTemplate"),r="";if(s){r=f.Template(s).render({text:t.text,value:t.value,disabled:t.disabled})}return r},_getItemList:function(){var r=this,s=r.get("items"),q=f.all("."+h,s);return q},_setDomStyle:function(){var r=this,t=r.get("items"),s=r.get("fitWidth"),q=r.get("height"),v=r.get("width"),x,w;t.css("visibility","hidden");r.open();x=r._getInnerWidth();w=r._getInnerHeight();if(s){var u=v;if(x>v){u=x;if(w>q){u+=18}}t.css("width",u)}else{t.css("width",v).css("overflow-x","hidden")}if(w>q){t.css("height",q).css("overflow-y","scroll")}else{t.css("height",w).css("overflow-y","inherit")}r.close();t.css("visibility","inherit")},_getInnerWidth:function(){var r=this,s=r.get("items"),q=r.get("itemsCon"),t;s.css("width","auto");t=q.outerWidth();return t},_getInnerHeight:function(){var r=this,q=r.get("itemsCon"),s=q.outerHeight(true);return s},_destroyItems:function(){var r=this,q=r._getItemList();q.detach().remove()},_initPlugins:function(r){var q=this,s=[];if(r.checkable){s.push(n)}if(r.searchable){s.push(d)}f.each(s,function(t){f.mix(r,t.config,true);f.mix(q,t.prototype,true)});r.pluginManage=s},_initPluginsEvent:function(){var q=this,r=q.get("pluginManage");f.each(r,function(s){s.initEvent.call(q)})}});f.namespace("LP");f.LP.Select=a},{requires:["lpmodule/select/multiple","lpmodule/select/search","2.0/uicommon","template","lpmodule/css/module.css"]});
