KISSY.add(function(b){function c(d){d.on("rowselected",function(f){e(f.row,true)});d.on("rowunselected",function(f){e(f.row,false)});function e(i,g){var f=b.one(i),h=f.one(".grid-radio");if(h){h.attr("checked",g)}}}var a=function(d){a.superclass.constructor.call(this,d);this._init()};a.Util={singleCheckGrid:c};a.ATTRS={contentId:{},dialog:{},dialogConfig:{value:{}},gridConfig:{},gridSelector:{value:".search-grid"},grid:{},form:{},button:{},onShow:{value:function(d){this.getData()}},searchButtonSelector:{value:"button"},searchUrl:{},store:{},formSelector:{value:"form"},singleSelect:{value:true},trigger:{},triggerTarget:{},radioColumn:{value:{title:"",dataIndex:"",width:30,renderer:function(){return'<input class="grid-radio" type="radio" />'}}}};b.extend(a,b.Base);b.augment(a,{_init:function(){var d=this;d._initDom();d._initDialog();d._initEvent();d._initDialogEvnet()},_initDom:function(){var d=this,h=d.get("contentId")||d.get("dialogConfig").contentId,f=b.one("#"+h),g=null,e=null;if(f){g=f.one(d.get("formSelector"));e=f.one(d.get("searchButtonSelector"));d.set("form",g);d.set("button",e)}},_initEvent:function(){var d=this,e=d.get("trigger"),f=d.get("dialog");if(e){b.all(d.get("trigger")).on("click",function(h){var g=b.one(h.target);d.set("triggerTarget",g);f.show()})}d.get("button").on("click",function(g){g.preventDefault();d.getData()})},_initGrid:function(){var d=this,g=d.get("dialogConfig"),k=d.get("gridConfig"),i=d.get("singleSelect"),h=d.get("form"),e=k.store||d.get("store"),f=null;if(i){var j=d.get("radioColumn");k.columns.unshift(j)}else{k.checkable=true}if(!e){e=new b.LP.Store({url:d.get("searchUrl")});d.set("store",e)}b.mix(k,{store:e,width:g.width-55,height:g.height-110-h.height(),forceFit:true});f=new b.LP.Grid(k);d.set("grid",f)},_initDialog:function(){var d=this,f=d.get("dialogConfig"),e=d.get("dialog");if(!e){e=new b.LP.Dialog(f);d.set("dialog",e)}},_initGridEvent:function(){var d=this;if(d.get("singleSelect")){c(d.get("grid"))}},_initDialogEvnet:function(){var d=this,e=d.get("dialog");e.on("show",function(){if(!d.get("grid")){d._initGrid();d._initGridEvent()}d.get("onShow").call(d,this)})},getData:function(){var d=this,e=d.get("store"),f=b.LP.FormHelpr.serializeToObject(d.get("form")[0]);f.start=0;f.pageIndex=0;e.load(f)},getSelection:function(){return this.get("grid").getSelection()},getSelected:function(){return this.get("grid").getSelected()}});return a});
