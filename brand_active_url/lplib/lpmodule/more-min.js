KISSY.add(function(e){var h=e.DOM,g=e.Event;var f='<p class="cut-line"></p>',a="J_DelGroup";function i(k){var j=this;k=e.merge(i.config,k);if(!k.tempId||!h.get("#"+k.tempId)){throw"please assign the id of template Dom!"}if(!k.addGroupId||!h.get("#"+k.addGroupId)){throw"please assign the id of Add More Button!"}if(!k.groupClass){throw"please assign the class of New Group!"}i.superclass.constructor.call(j,k);j.events=["beforeAddGroup","afterAddGroup","initGroup","alreadyMin","alreadyMax"];j._init()}i.config={tempId:null,groupClass:null,addGroupId:null,validater:null,inputAction:{},delText:"\u5220\u9664\u8be5\u7ec4",minGroup:1,maxGroup:100,minFunc:function(j){alert("\u6700\u5c11"+j+"\u7ec4\uff0c\u4e0d\u80fd\u7ee7\u7eed\u5220\u9664\uff01")},maxFunc:function(j){alert("\u6700\u591a"+j+"\u7ec4\uff0c\u4e0d\u80fd\u7ee7\u7eed\u6dfb\u52a0\uff01")}};e.extend(i,e.Base);e.augment(i,{set:function(j,k){i.superclass.set.call(this,j,k,{silent:1})},addNewGroup:function(){var j=this,l,k,m;if(j.fire("beforeAddGroup")===false){return}l=j._getNameNum();k={tempId:j.get("tempId"),addGroup:j.get("addGroup"),nameNum:l,delGroupStr:j.get("delGroupStr"),validater:j.get("validater"),groupClass:j.get("groupClass"),inputAction:j.get("inputAction")};m=new d(k);j.setGroup(l,m);j.fire("afterAddGroup",{group:m});return m},getGroupManager:function(){return this.get("groupManager")},getGroup:function(l){var j=this,k=j.getGroupManager();return k[l]||null},setGroup:function(l,m){var j=this,k=j.getGroupManager();j._initGroupEvent(m);if(!k[l]){j._setGroupLength(j._getGroupLength()+1)}k[l]=m;return k},delGroup:function(l){var j=this,k=j.getGroupManager();delete k[l];j._setGroupLength(j._getGroupLength()-1);return k},destroy:function(){var j=this,k=j.getGroupManager(),l=j.get("addGroup");j.set("isDestroy",true);e.each(k,function(m){m.destroy()});l.detach();j.detach()},_init:function(){var j=this,k=e.one("#"+j.get("addGroupId"));j.set("addGroup",k);j.set("delGroupStr",'<p class="del-group '+a+'">'+j.get("delText")+"</p>");j.set("groupManager",{});j.set("groupManagerLength",0);j.set("nameNum",0);j._initEchoGroups();j._initEvent()},_initEvent:function(){var j=this,k=j.get("addGroup");k.on("click",function(){j.addNewGroup()});j.on("beforeAddGroup",function(){return j._checkNumRange(1)})},_initGroupEvent:function(k){var j=this;k.on("deleting",function(){if(!j.get("isDestroy")){return j._checkNumRange(-1)}else{return true}});k.on("deleted",function(l){j.delGroup(l.nameNum)})},_initEchoGroups:function(){var k=this,q=k.get("validater"),m=k.get("inputAction"),j=k.get("groupClass"),l,p,o,n;l=h.query("."+j);e.each(l,function(r){p=k._getNameNum();o={domEl:r,nameNum:p,validater:q,inputAction:m};n=new c(o);k.setGroup(p,n);k.fire("initGroup",{group:n})})},_checkNumRange:function(l){var j=this,m=false,n=j.get("minGroup"),o=j.get("maxGroup"),q=j.get("minFunc"),k=j.get("maxFunc"),p=j._getGroupLength();if(p+l<n){q(n);j.fire("alreadyMin",{min:n})}else{if(p+l>o){k(o);j.fire("alreadyMax",{max:o})}else{m=true}}return m},_getGroupLength:function(){return this.get("groupManagerLength")},_setGroupLength:function(k){var j=this;j.set("groupManagerLength",k);return j._getGroupLength()},_getNameNum:function(){var j=this,k=j.get("nameNum");k++;j.set("nameNum",k);return k}});e.mix(i,{getDomFromName:function(k,j,l){l=l||"input";var m=h.filter(l,function(n){return h.attr(n,"name")===k},j);return m[0]?e.one(m[0]):null},initCalendar:function(j){j=e.merge({timeConfig:{},rules:{}},j);return function(n){var k=this,m=k.get("validater"),l,o=null;if(e.LP.Calendar){l=n.attr("id")||e.guid();n.attr("id",l);o=new e.LP.Calendar(l,j.timeConfig,{validater:m,rules:j.rules})}return o}},initJoinCalendar:function(j){if(!j||!j.endTimeName){throw"please assign the name of endTime!"}j=e.merge({startConfig:{},endConfig:{},rules:{}},j);return function(s){var q=this,k=q.get("groupEl"),o=q.get("validater"),m=s,p=i.getDomFromName(j.endTimeName,k),l,n,r=null;if(p&&e.LP.JoinCalendar){l=m.attr("id")||e.guid();n=p.attr("id")||e.guid();m.attr("id",l);p.attr("id",n);r=new e.LP.JoinCalendar([l,j.startConfig],[n,j.endConfig],{validater:o,rules:j.rules})}return r}}});function b(k){var j=this;k=e.merge(b.config,k);b.superclass.constructor.call(j,k);j.events=["deleting","deleted"];j.__init()}b.config={nameNum:0,validater:null,inputAction:{}};e.extend(b,e.Base);e.augment(b,{set:function(j,k){b.superclass.set.call(this,j,k,{silent:1})},getGroupEl:function(){var j=this;return j.get("groupEl")},getGroupDo:function(l){var k=this,m=k.getGroupEl(),j=["input","select","textarea"];e.each(j,function(n){e.each(e.all(n,m),function(o){l.call(k,e.one(o))})})},destroy:function(){var j=this,m=j.getGroupEl(),l=j.get("nameNum"),k=j.get("delGroup");if(j.fire("deleting",{nameNum:l})===false){return}j.getGroupDo(j._destroyElAction);k.detach();m.remove();j.set("groupEl",null);j.fire("deleted",{nameNum:l});j.detach()},__init:function(){var j=this;j.set("newObj",{})},_initEvent:function(){var j=this,l=j.getGroupEl(),k=e.one("."+a,l);k.on("click",function(){j.destroy()});j.set("delGroup",k)},_initGroup:function(){var j=this;j.getGroupDo(j._initElAction)},_initElAction:function(m){var j=this,k=j.get("inputAction"),o=m.attr("name"),n=k[o],l;if(o&&n&&!e.isEmptyObject(n)){l=m.attr("id")||e.guid();m.attr("id",l);j._bindRule(m,n.rules);j._bindFunc(m,n.func);j._bindEv(m,n.events)}j._setName(m)},_bindRule:function(m,n){var j=this,l=j.get("validater"),k=m.attr("id");if(n&&l){l.add("#"+k,n)}},_bindFunc:function(n,m){var j=this,k=j.get("newObj"),l=n.attr("id"),o=null;if(!!m&&e.isFunction(m)){o=m.call(j,n)||null;if(o){k[l]=[].concat(o)}}},_bindEv:function(k,j){if(j&&j.length>0){e.each(j,function(l){k.on(l.type,l.callback)})}},_destroyElAction:function(k){var j=this;j._delRule(k);j._delEv(k);j._delObj(k)},_delRule:function(m){var j=this,l=j.get("validater"),k=m.attr("id")||"";if(k&&l){l.fields.remove(k)}},_delEv:function(j){j.detach()},_delObj:function(m){var j=this,k=j.get("newObj"),l=m.attr("id");if(k[l]){e.each(k[l],function(n){if(e.isFunction(n.destroy)){n.destroy()}n=null});delete k[l]}},_setName:function(m){var j=this,l=j.get("nameNum"),n=m.attr("name")||"",k=j._getNewName(n,l);m.attr("name",k)},_getNewName:function(m,l){var k="",j=m.split(".");if(j.length===4){j[2]+=l;k=j.join(".")}else{k=m+l}return k}});function d(k){var j=this;if(!k.tempId||!h.get("#"+k.tempId)){throw"please assign the id of template Dom!"}k=e.merge(d.config,k);d.superclass.constructor.call(j,k);j.events=j.events.concat(["added"]);j._init()}d.config={tempId:null,addGroup:null,groupClass:null,delGroupStr:null};e.extend(d,b);e.augment(d,{_init:function(){var j=this,k=j.get("tempId"),l=e.one(h.create(["<div>",f,e.get("#"+k).innerHTML,j.get("delGroupStr"),"</div>"].join("")));l.addClass(j.get("groupClass"));j.set("groupEl",l);j._appendToDoc();j._initEvent();j._initGroup()},_appendToDoc:function(){var j=this,l=j.getGroupEl(),k=j.get("addGroup");l.insertBefore(k);j.fire("added",{group:j,nameNum:j.get("nameNum")});return j}});function c(k){var j=this;if(!k.domEl){throw"please assign the Dom!"}k=e.merge(c.config,k);c.superclass.constructor.call(j,k);j._init()}c.config={domEl:null};e.extend(c,b);e.augment(c,{_init:function(){var j=this,k=j.get("domEl"),l=e.one(k);j.set("groupEl",l);j._initEvent();j._initGroup()}});e.namespace("LP");e.LP.More=i},{requires:["lpmodule/css/module.css"]});
