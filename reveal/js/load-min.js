var FlattrLoader=function(){var b={instance:!1,queryString:!1,validParams:["mode","https","uid","category","button","language","html5-key-prefix","popout","revsharekey"],validButtonParams:["uid","owner","category","button","language","hidden","tags","title","url","description","revsharekey","popout"],options:{},POPOUT_WIDTH:401,POPOUT_HEIGHT:230,TIMEOUT:1500,createIframe:function(a){var f=a.button=="compact",e=document.createElement("iframe");return e.setAttribute("src",(this.getParam("https")==1?"https":"http")+"://"+this.getParam("domain","api.flattr.com")+"/button/view/?"+this.encodeData(a)),e.setAttribute("class","FlattrButton"),e.setAttribute("width",f==1?110:55),e.setAttribute("height",f==1?20:62),e.setAttribute("frameBorder",0),e.setAttribute("scrolling","no"),e.setAttribute("title","Flattr"),e.setAttribute("border",0),e.setAttribute("marginHeight",0),e.setAttribute("marginWidth",0),e.setAttribute("allowTransparency","true"),e.data=a,a.popout!=0&&(e.onmouseover=function(){this.popoutIframe===undefined&&(b.removeAllOpenPopoutIframes(),b.showPopoutForButton(this),this.popoutIframe.onmouseover=function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=undefined)},this.popoutIframe.onmouseout=function(){this.parentNode&&(this.timeout=setTimeout(function(){e.popoutIframe&&b.removePopoutForButton(e)},b.TIMEOUT))})},e.onmouseout=function(){this.popoutIframe&&(this.popoutIframe.timeout=setTimeout(function(){e.popoutIframe&&b.removePopoutForButton(e)},b.TIMEOUT))}),e},getAbsolutePositionForElement:function(d){var c={x:0,y:0};if(d.offsetParent){do{c.x+=d.offsetLeft,c.y+=d.offsetTop,d=d.offsetParent}while(d)}return c},showPopoutForButton:function(i){var h,n="s",m="e",l=window.innerWidth!==undefined?window.innerWidth:document.documentElement.clientWidth,k=window.innerHeight!==undefined?window.innerHeight:document.documentElement.clientHeight,j=this.getAbsolutePositionForElement(i);j.x>l/2&&(m="w"),j.y+Number(i.height)+this.POPOUT_HEIGHT>k&&(n="n"),h=n+m,i.data.dir=h,i.popoutIframe=this.createPopoutIframe(i.data),m==="w"?i.popoutIframe.style.left=Number(j.x)-Number(this.POPOUT_WIDTH)+Number(i.width)+"px":m==="e"&&(i.popoutIframe.style.left=j.x+"px"),n==="n"?i.popoutIframe.style.top=Number(j.y)-Number(this.POPOUT_HEIGHT)+"px":n==="s"&&(i.popoutIframe.style.top=Number(j.y)+Number(i.height)+"px"),document.querySelector("body").appendChild(i.popoutIframe)},createPopoutIframe:function(d){var c=document.createElement("iframe");return c.setAttribute("src",(this.getParam("https")==1?"https":"http")+"://"+this.getParam("domain","api.flattr.com")+"/button/popout/?"+this.encodeData(d)),c.setAttribute("frameBorder",0),c.setAttribute("allowTransparency","true"),c.setAttribute("style","position: absolute; display:block; z-index: 9999;"),c.setAttribute("width",this.POPOUT_WIDTH),c.setAttribute("height",this.POPOUT_HEIGHT),c},removePopoutForButton:function(c){c.popoutIframe.timeout&&clearTimeout(c.popoutIframe.timeout),c.popoutIframe.parentNode.removeChild(c.popoutIframe),c.popoutIframe=undefined},removeAllOpenPopoutIframes:function(){var e=document.querySelectorAll("iframe.FlattrButton"),d,f;for(d=0;d<e.length;d+=1){f=e[d],f.popoutIframe&&this.removePopoutForButton(f)}},reshowAllOpenPopoutIframes:function(){var e=document.querySelectorAll("iframe.FlattrButton"),d,f;for(d=0;d<e.length;d+=1){f=e[d],f.popoutIframe&&(this.removePopoutForButton(f),this.showPopoutForButton(f))}},encodeData:function(f){var e,h,g="";for(e in f){f.hasOwnProperty(e)&&(h=f[e],e=="description"&&(h=this.stripTags(h,"<br>"),h.length>1000&&(h=h.substring(0,1000))),h=h.replace(/^\s+|\s+$/g,"").replace(/\s{2,}|\t+/g," "),g+=e+"="+encodeURIComponent(h)+"&")}return g},getParam:function(d,c){return typeof this.options[d]!="undefined"?this.options[d]:c},init:function(){var D,C,B,A,z,y,x,w,v,u,t,s,r=document.getElementsByTagName("script");try{for(D=r.length-1;D>=0;D--){C=r[D];if(!C.hasAttribute("src")){continue}B=C.src,A=new RegExp("^(http(?:s?))://(api\\.(?:.*\\.?)flattr\\.(?:com|dev))","i"),z=B.match(A);if(z){this.options.domain=z[2].toString(),this.options.https=z[1].toString()=="https"?1:0,y=B.indexOf("?");if(y){x=B.substring(++y),w=x.split("&");for(u=0;u<w.length;u++){v=w[u].split("="),this.validParam(v[0],this.validParams)&&(this.options[v[0]]=v[1])}}this.instance=C;break}}}catch(q){}window.addEventListener!==undefined?(t=window.addEventListener,s="message"):(t=window.attachEvent,s="onmessage"),t(s,function(e){var g;try{g=JSON.parse(e.data)}catch(f){g={}}g.flattr_button_event==="popout_close_button_clicked"?b.removeAllOpenPopoutIframes():g.flattr_button_event==="click_successful"&&b.reshowAllOpenPopoutIframes()},!1);switch(this.getParam("mode","manual")){case"direct":this.render();break;case"auto":case"automatic":var a=this;this.domReady(function(){a.setup()});break;case"manual":default:}return this},loadButton:function(j){var i,p,o,n,m,l={},k=null;for(i in this.options){this.options.hasOwnProperty(i)&&this.validParam(i,this.validButtonParams)&&(l[i]=this.options[i])}j.href&&(l.url=j.href),j.getAttribute("title")&&(l.title=j.getAttribute("title")),j.getAttribute("lang")&&(l.language=j.getAttribute("lang")),j.innerHTML&&(l.description=j.innerHTML);if((k=j.getAttribute("rev"))!==null&&k.substring(0,6)=="flattr"||(k=j.getAttribute("rel"))!==null&&k.substring(0,6)=="flattr"){k=k.substring(7).split(";");for(p=0;p<k.length;p++){o=k[p].split(":"),n=o.shift(),this.validParam(n,this.validButtonParams)&&(l[n]=o.join(":"))}}else{for(m in this.validButtonParams){this.validButtonParams.hasOwnProperty(m)&&(k=j.getAttribute(this.getParam("html5-key-prefix","data-flattr")+"-"+this.validButtonParams[m]))!==null&&(l[this.validButtonParams[m]]=k)}}this.replaceWith(j,this.createIframe(l))},render:function(i,h,n){var m,l={};for(m in this.options){this.options.hasOwnProperty(m)&&this.validParam(m,this.validButtonParams)&&(l[m]=this.options[m])}try{if(i){for(m in i){i.hasOwnProperty(m)&&this.validParam(m,this.validButtonParams)&&(l[m]=i[m])}}else{window.flattr_uid&&(l.uid=window.flattr_uid),window.flattr_url&&(l.url=window.flattr_url),window.flattr_btn&&(l.button=window.flattr_btn),window.flattr_hide&&(l.hidden=window.flattr_hide==1?1:0),window.flattr_cat&&(l.category=window.flattr_cat),window.flattr_tag&&(l.tags=window.flattr_tag),window.flattr_lng&&(l.language=window.flattr_lng),window.flattr_tle&&(l.title=window.flattr_tle),window.flattr_dsc&&(l.description=window.flattr_dsc)}var k=this.createIframe(l);if(h){typeof h=="string"&&(h=document.getElementById(h));switch(n){case"before":h.parentNode.insertBefore(k,h);break;case"replace":this.replaceWith(h,k);break;case"append":default:h.appendChild(k)}}else{this.getParam("mode","manual")=="direct"&&this.replaceWith(this.instance,this.createIframe(l))}}catch(j){}},replaceWith:function(f,e){if(typeof e=="string"){if(typeof document.documentElement.outerHTML!="undefined"){f.outerHTML=e}else{var h=document.createRange();h.selectNode(f),e=h.createContextualFragment(e),f.parentNode.replaceChild(e,f)}}var g=f.parentNode;g.replaceChild(e,f)},setup:function(){var f,e,h;if(document.querySelectorAll){try{h=document.querySelectorAll("a.FlattrButton")}catch(g){}}if(h==undefined){h=[],f=document.getElementsByTagName("a");for(e=f.length-1;e>=0;e--){/FlattrButton/.test(f[e].className)&&(h[h.length]=f[e])}}for(e=h.length-1;e>=0;e--){this.loadButton(h[e])}},stripTags:function(v,u){var t="",s=!1,r=[],q=[],p="",o=0,n="",m="",l=function(e,d,f){return f.split(e).join(d)};u&&(q=u.match(/([a-zA-Z0-9]+)/gi)),v+="",r=v.match(/(<\/?[\S][^>]*>)/gi);for(t in r){if(r.hasOwnProperty(t)){if(isNaN(t)){continue}m=r[t].toString(),s=!1;for(n in q){if(q.hasOwnProperty(n)){p=q[n],o=-1,o!=0&&(o=m.toLowerCase().indexOf("<"+p+">")),o!=0&&(o=m.toLowerCase().indexOf("<"+p+" ")),o!=0&&(o=m.toLowerCase().indexOf("</"+p));if(o==0){s=!0;break}}}s||(v=l(m,"",v))}}return v},validParam:function(e,d){var f;for(f=0;f<d.length;f++){if(d[f]==e){return !0}}return !1}};return b}();!function(z,y){function x(b){n=1;while(b=w.shift()){b()}}var w=[],v,u,t=!1,s=y.documentElement,r=s.doScroll,q="DOMContentLoaded",p="addEventListener",o="onreadystatechange",n=/^loade|c/.test(y.readyState);y[p]&&y[p](q,u=function(){y.removeEventListener(q,u,t),x()},t),r&&y.attachEvent(o,v=function(){/^c/.test(y.readyState)&&(y.detachEvent(o,v),x())}),z.domReady=r?function(a){self!=top?n?a():w.push(a):function(){try{s.doScroll("left")}catch(b){return setTimeout(function(){z.domReady(a)},50)}a()}()}:function(b){n?b():w.push(b)}}(FlattrLoader,document),FlattrLoader.init();
