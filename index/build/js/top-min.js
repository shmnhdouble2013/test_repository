
/* build Date:2015-01-12 6:02:45 PM author:huangjia */
$(document).ready(function(){function a(a){var b=0,c=0;for(c;c<a.length;c++)a.charCodeAt(c)>255?b+=2:b++;return b}!function(b){var c=window.config.aURL.sMemberDomain+"/api/user/getuser.html";b.ajax({url:c,dataType:"jsonp",jsonp:"callback",success:function(c){if("1"==c.iStatus){b("#isLogin").attr("value",!0);var d=c.aData.nickname;a(d)>11&&(d=d.substring(0,11)+"..");{c.aData.url}b("#topLogin").text(d),b("#topLogin").attr("href",c.aData.url),b("#topLogin").attr("target","_blank"),b("#topLogout").show(),b("#topRegister").hide()}else b("#topLogout")&&b("#topLogout").hide()}})}($),function(a){function b(a,b){var b=b&&"("+b+")",b=b?b:"";return d&&e?g?(e.show(),void(a?(d.text(b),e.addClass(f),d.show()):(d.text(""),e.removeClass(f),d.hide()))):void e.hide():void console.log("站内信a链接和未读数据span没找到，缺少id")}var c=window.config.aURL.sMemberDomain+"/api/message/getMessNum.html",d=a("#J_sites-msgnum"),e=d.parent("a"),f="color-fc6800",g=null;a.ajax({url:c,dataType:"jsonp",jsonp:"callback",success:function(a){if(g=a.iStatus,1==g){var c=a.aData.iNoReadCount;0>=c||!c?b():b(!0,c)}else b()}})}($),$("#topLogin").bind("click",function(){if("_blank"!=$("#topLogin").prop("target")){var a=window.config.aURL.sMemberDomain+"/user/login/?return_url="+window.location.href;return window.location.href=a,!1}}),$("#topLogout").bind("click",function(a){a.preventDefault();var b=window.config.aURL.sMemberDomain+"/api/user/logout.html";$.ajax({url:b,dataType:"jsonp",jsonp:"callback",success:function(a){"1"==a.iStatus&&window.location.reload()}})}),$("#topRegister").bind("click",function(){var a=window.config.aURL.sMemberDomain+"/user/register/?return_url="+window.location.href;return window.location.href=a,!1})});